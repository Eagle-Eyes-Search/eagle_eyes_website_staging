<style>
    .pricing-container {
      display: flex;
      justify-content: center;
      gap: 3rem;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 2rem;
    }
    
    .pricing-box {
      flex: 1;
      max-width: 500px;
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      transition: box-shadow 0.3s ease;
    }
    
    .pricing-box:hover {
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
    }
    
    .pricing-box-header {
      background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%);
      border-bottom: 3px solid #dee2e6;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      padding: 2rem 2rem 1.5rem;
      text-align: center;
      height: 320px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .header-top-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    
    .header-bottom-section {
      margin-top: auto;
    }
    
    .pricing-box-content {
      padding: 2rem;
    }
    
    .pricing-box-features {
      margin-top: 2rem;
    }
    
    .feature-item {
      padding: 1rem 0;
      border-bottom: 1px solid #e9ecef;
      color: #333;
      font-size: 1.3rem;
      line-height: 1.5;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }
    
    .feature-item:hover {
      background-color: #f8f9fa;
    }
    
    .feature-dropdown {
      display: none;
      padding: 1rem;
      background-color: #f8f9fa;
      border-top: 1px solid #e9ecef;
      font-size: 1.1rem;
      line-height: 1.6;
      color: #555;
    }
    
    .feature-dropdown.show {
      display: block;
    }
    
    .feature-item:last-child {
      border-bottom: none;
    }
    
    .feature-item.empty {
      color: transparent;
      border-bottom: none;
    }
    
    .lead {
      font-size: 28px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #333;
    }
    
    .section-description {
      margin-bottom: 1.5rem;
    }
    
    .section-description p {
      margin: 0;
      color: #555;
      line-height: 1.6;
      font-size: 1.3rem;
    }
    
    .section-title {
      margin-bottom: 1rem;
    }
    
    .section-title h2 {
      font-size: 1.6rem;
      margin: 0;
      font-weight: 600;
      color: #333;
      line-height: 1.3;
      text-align: center;
    }
    
    .section-price {
      margin: 1.5rem 0;
      text-align: center;
    }
    
    .section-price.free-price {
      margin-bottom: 2.5rem;
    }
    
    .section-price .dollars {
      font-size: 2.2rem;
      margin: 0;
      font-weight: 500;
      color: #000000;
    }
    
    .section-button {
      margin: 1.5rem 0;
      text-align: center;
    }
    
    .section-button button {
      display: block;
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 600;
      border-radius: 4px;
      cursor: pointer;
      min-width: 160px;
      margin: 0 auto;
      transition: all 0.3s ease;
      background-color: #000;
      color: #fff;
      border: 1px solid #000;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .section-button button:hover {
      background-color: #1e90ff;
      color: #fff;
      border: 1px solid transparent;
      transform: none;
    }
    
    .section-button .secondary-button {
      background-color: transparent;
      color: #000;
      border: 1px solid #000;
      box-shadow: none;
    }
    
    .section-button .secondary-button:hover {
      background-color: #1e90ff;
      color: #fff;
      border: 1px solid transparent;
    }
    
    .section-info {
      margin-top: 1rem;
      text-align: center;
    }
    
    .section-info button {
      background: none;
      border: none;
      color: #007bff;
      font-size: 14px;
      cursor: pointer;
      padding: 8px 12px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      gap: 5px;
      text-decoration: underline;
    }
    
    /* Device Calculator Styles */
    .device-calculator {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.8rem;
    }

    .device-input-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
    }
    
    .device-input {
      width: 80px;
      height: 40px;
      border: 1px solid #ddd;
      border-radius: 0;
      text-align: center;
      font-size: 16px;
      font-weight: 600;
      background-color: #fff;
      transition: border-color 0.3s ease;
      transform: translateY(6px);
      -webkit-appearance: none;
      -moz-appearance: textfield;
    }
    
    .device-input::-webkit-outer-spin-button,
    .device-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    
    .device-input:focus {
      outline: none;
      border-color: var(--blue-highlight);
    }
    
    .device-input:invalid {
      border-color: #ff6b6b;
    }
    
    .pricing-formula {
      font-size: 1.6rem;
      color: #666;
      text-align: center;
      line-height: 1.4;
      margin-top: 0.5rem;
    }
    
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
    }
    
    .modal-content {
      background-color: #fefefe;
      margin: 15% auto;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.3);
      position: relative;
    }
    
    .close {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      position: absolute;
      top: 15px;
      right: 20px;
      cursor: pointer;
    }
    
    .close:hover,
    .close:focus {
      color: #000;
      text-decoration: none;
    }
    
    .modal h3 {
      margin-top: 0;
      margin-bottom: 20px;
      color: #333;
      font-size: 1.5rem;
      font-weight: 600;
    }
    
    .modal p {
      margin-bottom: 15px;
      line-height: 1.6;
      color: #555;
    }
    
    .modal .bullet {
      text-align: center;
      font-size: 20px;
      color: #007bff;
      margin: 20px 0;
    }

    /* Main heading - match with "Eagle Eyes Pilot for Android" on index.html */
    .pricing-header {
      text-align: center;
      padding-left: 20px;
      padding-right: 20px;
    }
    
    .pricing-header h2 {
      text-align: center;
      margin-bottom: 30px;
      font-weight: inherit;
      font-size: inherit;
      color: inherit;
      line-height: inherit;
      letter-spacing: inherit;
    }

    /* Subheading - increase size and ensure font consistency */
    .pricing-header p {
      text-align: center;
      max-width: 800px;
      margin: 0 auto 3rem;
      color: #555;
      font-size: 1.8rem;
      line-height: 1.6;
      font-weight: 400;
        font-family: inherit;
    }

    /* Info links container styling */
    .info-links-container {
        text-align: center;
      margin: 0.5rem auto 1rem;
      max-width: 600px;
      padding: 0.5rem;
      font-size: 1.5rem;
    }
    
    .info-links-container p {
      /* Allow natural text wrapping */
    }
    
    .info-links-container p {
      margin-bottom: 0.8rem;
      color: #444;
    }
    
    .info-links-container p:last-child {
        margin: 0;
    }
    
    .info-links-container a {
      color: var(--blue-highlight);
      font-weight: 500;
      text-decoration: none;
      transition: all 0.3s ease;
    }
    
    .info-links-container a:hover {
      text-decoration: underline;
    }
    
    .info-links-container .flag {
      margin-left: 5px;
    }

    @media (max-width: 768px) {
      .pricing-container {
        flex-direction: column;
        gap: 2rem;
        padding: 0 1rem;
      }
      
      .pricing-box {
        max-width: none;
      }
      
      .device-calculator {
        gap: 0.5rem;
      }
      
      .pricing-formula {
        font-size: 1.1rem;
      }
      
      .section-title h2 {
        font-size: 1.4rem;
      }
      
      .lead {
        font-size: 1.2rem;
      }
      
      .pricing-header p {
        font-size: 1.5rem;
      }
      
      .info-links-container p {
        /* Allow natural text wrapping on mobile */
      }
    }

    @media (max-width: 480px) {
      .pricing-container {
        gap: 1.5rem;
        padding: 0 0.5rem;
      }
      
      .pricing-box-header {
        padding: 1.5rem 1rem 1rem;
      }
      
      .pricing-box-content {
        padding: 1.5rem;
      }
      
      .section-title h2 {
        font-size: 1.3rem;
      }
      
      .lead {
        font-size: 1.1rem;
      }
      
      .device-input {
        width: 50px;
        height: 30px;
        font-size: 12px;
      }
      
      .pricing-formula {
        font-size: 1rem;
      }
      
      .dollars {
        font-size: 1.8rem !important;
      }
      
    .pricing-header p {
        font-size: 1.3rem;
        white-space: normal;
        overflow: visible;
        text-overflow: clip;
      }
    }
</style>
  
  <div style="margin-top: 14rem; margin-bottom: 5rem;">
    <div class="pricing-header">
        <h2 style="margin-bottom: 10px; font-weight: 300; font-size: 2.8rem; color: #333; line-height: 1.2; text-align: center;">Pricing</h2>
        <p>All prices listed include full access to all Eagle Eyes products and features for 1 year.</p>
    </div>
    

    
    <div class="pricing-container">
                           <!-- Free Plan Box -->
         <div class="pricing-box">
           <div class="pricing-box-header">
             <div class="header-top-section">
               <p style="font-size: 28px; font-weight: bold; margin: 0.5rem 0 1rem 0; color: #333;">Free</p>
              <div class="section-description">
                  <p>Access Eagle Eyes<br>basic features for free</p>
                </div>
              </div>
             <div class="header-bottom-section">
               <div class="section-price free-price">
                <p class="dollars">USD $0</p>
              </div>
              <div class="section-button">
                <button class="secondary-button" style="min-width: 160px;">Get Eagle Eyes</button>
              </div>
             </div>
           </div>
        <div class="pricing-box-content">
          <div class="pricing-box-features">
            <div class="feature-item" onclick="toggleFeatureDropdown('free-feature-1')">Upload drone GPS tracks to CalTopo</div>
            <div class="feature-dropdown" id="free-feature-1">
              Fly online or offline in EagleEyes Pilot or DJI Pilot 2, then quickly upload your drone's GPS tracks to CalTopo once you're back in service.<br><br>
              <a href="https://www.youtube.com/watch?v=kL0-SSLd23c" target="_blank" rel="noopener" style="color: #007bff; text-decoration: underline;">See YouTube video description here</a>
            </div>
            <div class="feature-item" onclick="toggleFeatureDropdown('free-feature-2')">Convert CalTopo search areas into DJI flight mission plans</div>
            <div class="feature-dropdown" id="free-feature-2">
              Easily turn CalTopo search areas into KML files and import them directly into DJI Pilot 2 as ready-to-fly mission plans.<br><br>
              <a href="https://www.youtube.com/watch?v=0i_ph36RUqE" target="_blank" rel="noopener" style="color: #007bff; text-decoration: underline;">See YouTube video description here</a>
            </div>
            <div class="feature-item" onclick="toggleFeatureDropdown('free-feature-3')">AirOps map view with live multi-drone tracking and Caltopo connection</div>
            <div class="feature-dropdown" id="free-feature-3">
              When connected to the same local Wi-Fi network as drone controllers broadcasting their locations to the EagleEyes AirOps map (location broadcast is possible while flying in either EagleEyes Pilot or DJI Pilot 2), view the AirOps map on your android device and see near-zero latency live multi-drone positions overlaid on CalTopo map features.<br><br>
              <a href="https://www.youtube.com/watch?v=__i8BL0HGOU&t=5s" target="_blank" rel="noopener" style="color: #007bff; text-decoration: underline;">See YouTube video description here</a>
            </div>
          </div>
        </div>
      </div>

                           <!-- Paid Plan Box -->
         <div class="pricing-box">
           <div class="pricing-box-header">
             <div class="header-top-section">
               <p style="font-size: 28px; font-weight: bold; margin: 0.5rem 0 1rem 0; color: #333;">Pro</p>
                               <div class="section-description">
                  <p>Includes full access to all Eagle Eyes<br>features and tools</p>
                </div>
               <div class="pricing-formula">
                 <strong>USD $400</strong> for 1st device<br>
                 +<strong>USD $150</strong> per additional device
               </div>
             </div>
             <div class="header-bottom-section">
               <div class="section-info">
                 <button id="infoButton" style="background: none; border: none; color: #007bff; font-size: 14px; cursor: pointer; padding: 8px 12px; border-radius: 6px; display: flex; align-items: center; justify-content: center; margin: 0 auto; gap: 5px; text-decoration: underline;">ⓘ License Terms and Options</button>
               </div>
               <div class="section-button" style="display: flex; gap: 5px; justify-content: center;">
                 <button class="secondary-button" style="min-width: 130px;" id="freeTrialButton">30 Day Free Trial</button>
                 <button class="secondary-button" style="min-width: 130px;" id="purchaseLicenseButton">Purchase License</button>
               </div>
             </div>
           </div>
           
           <!-- Device Selection Dropdown (Hidden Initially) -->
           <div id="deviceSelectionSection" style="display: none; padding: 2rem; background: #f8f9fa; border-top: 1px solid #e9ecef;">
              <div class="section-title">
                <h2>Select number of devices</h2>
              </div>
              <div class="section-description">
                <div class="device-calculator">
                  <div class="device-input-group">
                    <div style="display: flex; align-items: center; justify-content: center; gap: 0;">
                      <button id="decreaseDevices" style="width: 35px; height: 40px; border: none; background: transparent; border-radius: 4px 0 0 4px; cursor: pointer; font-size: 18px; font-weight: 900;">−</button>
                      <input type="number" id="deviceCount" class="device-input" min="1" max="12" value="1">
                      <button id="increaseDevices" style="width: 35px; height: 40px; border: none; background: transparent; border-radius: 0 4px 4px 0; cursor: pointer; font-size: 18px; font-weight: 900;">+</button>
                   </div>
                   <div style="text-align: center; margin-top: 8px;">
                     <span style="font-size: 16px; color: #666;">device(s)</span>
                    </div>
                  </div>
                  <div class="pricing-formula">
                    <span id="customPricingText" style="font-size: 1.1rem; color: #888; font-style: italic; display: none;">* Custom pricing available for large organizations<br>
                    <a href="mailto:info@eagleeyessearch.com" style="color: var(--blue-highlight); text-decoration: none;">inquire at: info@eagleeyessearch.com</a></span>
                  </div>
                </div>
              </div>
              <div class="section-price">
                <p class="dollars" id="calculatedPrice">USD $400</p>
                <p style="font-size: 1.1rem; color: #666; margin-top: 0.5rem; line-height: 1.4;">Additional devices can be added at any time for a one-time fee of $20 for each month remaining in your current license term. For example, if you have 3 months left, the cost would be $60.</p>
              </div>
             
              <div class="section-button">
                <button style="min-width: 160px;" id="purchaseButton">Continue</button>
              </div>
           </div>
        <div class="pricing-box-content">
          <div class="pricing-box-features">
            <div class="feature-item" onclick="toggleFeatureDropdown('pro-feature-1')" style="color: #888;">Upload drone GPS tracks to CalTopo</div>
            <div class="feature-dropdown" id="pro-feature-1">
              Fly online or offline in EagleEyes Pilot or DJI Pilot 2, then quickly upload your drone's GPS tracks to CalTopo once you're back in service.<br><br>
              <a href="https://www.youtube.com/watch?v=kL0-SSLd23c" target="_blank" rel="noopener" style="color: #007bff; text-decoration: underline;">See YouTube video description here</a>
            </div>
            <div class="feature-item" onclick="toggleFeatureDropdown('pro-feature-2')" style="color: #888;">Convert CalTopo search areas into DJI flight mission plans</div>
            <div class="feature-dropdown" id="pro-feature-2">
              Easily turn CalTopo search areas into KML files and import them directly into DJI Pilot 2 as ready-to-fly mission plans.<br><br>
              <a href="https://www.youtube.com/watch?v=0i_ph36RUqE" target="_blank" rel="noopener" style="color: #007bff; text-decoration: underline;">See YouTube video description here</a>
            </div>
            <div class="feature-item" onclick="toggleFeatureDropdown('pro-feature-3')" style="color: #888;">AirOps map view with live multi-drone tracking</div>
            <div class="feature-dropdown" id="pro-feature-3">
              When connected to the same local Wi-Fi network as drone controllers broadcasting their locations to the EagleEyes AirOps map (location broadcast is possible while flying in either EagleEyes Pilot or DJI Pilot 2), view the AirOps map on your android device and see near-zero latency live multi-drone positions overlaid on CalTopo map features.<br><br>
              <a href="https://www.youtube.com/watch?v=__i8BL0HGOU&t=5s" target="_blank" rel="noopener" style="color: #007bff; text-decoration: underline;">See YouTube video description here</a>
            </div>
            <div class="feature-item" onclick="toggleFeatureDropdown('pro-feature-4')">Fly your drone with Eagle Eyes Pilot app</div>
            <div class="feature-dropdown" id="pro-feature-4">
              Use EagleEyes Pilot as a complete piloting app with advanced flight controls and a map view that allows you to fly with reference to your CalTopo map.
            </div>
            <div class="feature-item" onclick="toggleFeatureDropdown('pro-feature-4b')">Full access to Eagle Eyes computer vision</div>
            <div class="feature-dropdown" id="pro-feature-4b">
              Computer vision color and motion anomaly detection, both real time on the live feed while the drone is in the air and for post processing analysis of recorded images and videos.
            </div>
            <div class="feature-item" onclick="toggleFeatureDropdown('pro-feature-5')">Real-time CalTopo live location / GPS tracking</div>
            <div class="feature-dropdown" id="pro-feature-5">
              Stream your drone's live GPS location and GPS tracks directly into CalTopo while flying in either EagleEyes Pilot or DJI Pilot 2.<br><br>
              <a href="https://www.youtube.com/watch?v=wyg47If033M" target="_blank" rel="noopener" style="color: #007bff; text-decoration: underline;">See video description of live tracking CalTopo from Eagle Eyes Pilot</a><br><br>
              <a href="https://www.youtube.com/watch?v=gos2qwe04_Q" target="_blank" rel="noopener" style="color: #007bff; text-decoration: underline;">See video description of live tracking to CalTopo from DJI Pilot 2</a>
            </div>
            <div class="feature-item" onclick="toggleFeatureDropdown('pro-feature-6')">Add full res geolocated photos to CalTopo while the drone is in the air</div>
            <div class="feature-dropdown" id="pro-feature-6">
              Upload up to full-resolution geolocated drone images to CalTopo as photo points.
            </div>
            <div class="feature-item" onclick="toggleFeatureDropdown('pro-feature-7')">Full access to all Eagle Eyes Scan (desktop app) features</div>
            <div class="feature-dropdown" id="pro-feature-7">
              Access the full EagleEyes Scan feature set, including:<br>
              – Real-time detection on live drone imagery via clean HDMI feed<br>
              – Real-time coordinate transmission from DJI drone controllers over local Wi-Fi networks to display drones live location on the Eagle Eyes Scan map<br>
              – Compatibility with any drone capable of clean HDMI output<br>
              – Ability to run the detector in real-time while flying in EagleEyes Pilot or DJI Pilot 2 and feeding an HDMI livestream into Eagle Eyes Scan from your drone controller<br>
              – Post-mission computer vision analysis of still images and video files<br>
              – Mosaic view for fast review of large image sets and videos, highlighting anomalies and geolocating detections<br>
              – Export detections as geolocated photo points into CalTopo or other mapping tools<br><br>
              <a href="https://www.youtube.com/watch?v=cwZ4tvBRdjA&t=2s" target="_blank" rel="noopener" style="color: #007bff; text-decoration: underline;">See YouTube video description here</a>
            </div>
          </div>
        </div>
      </div>
              </div>
  </div>

  <!-- Modal -->
  <div id="infoModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h3>License Terms and Options</h3>
      <p>A verified account is required to purchase a license. Verification typically takes 1–3 business days.</p>
      <div class="bullet">•</div>
      <p>All Pro plan prices are for annual subscriptions and include full access to all Eagle Eyes products and features.</p>
      <div class="bullet">•</div>
      <p>Once activated on a device, a license is permanently tied to that device. If a device is lost or another unexpected issue occurs, the Eagle Eyes team can help move your license to a replacement device on a case-by-case basis.</p>
      <div class="bullet">•</div>
      <p>Additional devices can be added at any time for a one-time fee of $20 for each month remaining in your current license term. For example, if you have 3 months left, the cost would be $60.</p>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize device count calculator
        const deviceInput = document.getElementById('deviceCount');
        const decreaseBtn = document.getElementById('decreaseDevices');
        const increaseBtn = document.getElementById('increaseDevices');
        const priceDisplay = document.getElementById('calculatedPrice');
        const purchaseButton = document.getElementById('purchaseButton');
        
        function calculatePrice(deviceCount) {
            if (deviceCount < 1) return 400;
            if (deviceCount > 12) deviceCount = 12; // Cap at 12 devices
            if (deviceCount === 1) return 400;
            return 400 + (deviceCount - 1) * 150;
        }
        
        function updatePrice() {
            let deviceCount = parseInt(deviceInput.value) || 1;
            
            // Ensure device count is within valid range
            if (deviceCount > 12) {
                deviceCount = 12;
                deviceInput.value = 12;
            }
            if (deviceCount < 1) {
                deviceCount = 1;
                deviceInput.value = 1;
            }
            
            const price = calculatePrice(deviceCount);
            priceDisplay.textContent = `USD $${price.toLocaleString()}`;
            
            // Update button data attributes for purchase
            purchaseButton.setAttribute('data-device-count', deviceCount);
            
            // Show/hide custom pricing text based on device count
            const customPricingText = document.getElementById('customPricingText');
            if (deviceCount === 12) {
                customPricingText.style.display = 'inline';
            } else {
                customPricingText.style.display = 'none';
            }
        }
        
        // Handle input field changes (keyboard input)
        deviceInput.addEventListener('input', updatePrice);
        deviceInput.addEventListener('change', updatePrice);
        
        // Handle decrease button
        decreaseBtn.addEventListener('click', function() {
            let currentValue = parseInt(deviceInput.value) || 1;
            if (currentValue > 1) {
                deviceInput.value = currentValue - 1;
                updatePrice();
            }
        });
        
        // Handle increase button  
        increaseBtn.addEventListener('click', function() {
            let currentValue = parseInt(deviceInput.value) || 1;
            if (currentValue < 12) {
                deviceInput.value = currentValue + 1;
                updatePrice();
            }
        });
        
        // Initialize with default value
        updatePrice();
        
        // Modal functionality
        const modal = document.getElementById('infoModal');
        const infoButton = document.getElementById('infoButton');
        const closeButtons = document.querySelectorAll('.close');
        
        // Open modal when info button is clicked
        infoButton.addEventListener('click', function() {
            modal.style.display = 'block';
        });
        
        // Close modal when X is clicked
        closeButtons.forEach(function(closeButton) {
            closeButton.addEventListener('click', function() {
                modal.style.display = 'none';
            });
        });
        
        // Close modal when clicking outside of it
        window.addEventListener('click', function(event) {
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        });
        
        // Add click handlers to buttons
        const freeButton = document.querySelector('.pricing-box:first-child .section-button button');
        const freeTrialButton = document.getElementById('freeTrialButton');
        const purchaseLicenseButton = document.getElementById('purchaseLicenseButton');
        const paidButton = document.getElementById('purchaseButton');
        const deviceSelectionSection = document.getElementById('deviceSelectionSection');
        
        // Free plan button
        freeButton.addEventListener('click', function() {
                        const url = new URL(getUrlWithEmulatorParam('{{ "/download/" | relative_url }}'), window.location.origin);
                        // Add machine_id if present in current URL
                        const currentMachineId = new URLSearchParams(window.location.search).get('machine_id');
                        if (currentMachineId) {
                            url.searchParams.set('machine_id', currentMachineId);
                        }
            // Add step parameter to go directly to step 2 (mobile device selection)
            url.searchParams.set('step', '2');
                        window.location.href = url.toString();
                    });
        
        // Free trial button - goes to account page with trial reason
        freeTrialButton.addEventListener('click', function() {
            const url = new URL(getUrlWithEmulatorParam('{{ "/account/" | relative_url }}'), window.location.origin);
            url.searchParams.set('reason', 'trial');
            
            // Add machine_id if present in current URL
            const currentMachineId = new URLSearchParams(window.location.search).get('machine_id');
            if (currentMachineId) {
                url.searchParams.set('machine_id', currentMachineId);
            }
            
            window.location.href = url.toString();
        });
        
        // Purchase license button - shows device selection
        purchaseLicenseButton.addEventListener('click', function() {
            deviceSelectionSection.style.display = 'block';
            this.parentElement.style.display = 'none';
        });
        
        // Paid plan button (after device selection)
        paidButton.addEventListener('click', function() {
                        const deviceCount = this.getAttribute('data-device-count');
                        
                        // Create a URL that includes device count information
                        const url = new URL(getUrlWithEmulatorParam('{{ "/account/?reason=purchase" | relative_url }}'), window.location.origin);
                        url.searchParams.set('device_count', deviceCount);
                        
                        // Add machine_id if present in current URL
                        const currentMachineId = new URLSearchParams(window.location.search).get('machine_id');
                        if (currentMachineId) {
                            url.searchParams.set('machine_id', currentMachineId);
                        }
                        
                        window.location.href = url.toString();
        });
    });
    
    // Helper function to preserve emulator parameter
    function getUrlWithEmulatorParam(url) {
        const isEmulator = new URLSearchParams(window.location.search).get('is_emulator') === 'true';
        if (!isEmulator) return url;
        
        const separator = url.includes('?') ? '&' : '?';
        return url.includes('is_emulator=true') ? url : `${url}${separator}is_emulator=true`;
    }
    
    // Function to toggle feature dropdowns
    function toggleFeatureDropdown(featureId) {
        const dropdown = document.getElementById(featureId);
        const isVisible = dropdown.classList.contains('show');
        
        // Close all other dropdowns first
        document.querySelectorAll('.feature-dropdown').forEach(dd => {
            dd.classList.remove('show');
        });
        
        // Toggle the clicked dropdown
        if (!isVisible) {
            dropdown.classList.add('show');
        }
    }
  </script>