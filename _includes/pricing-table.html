<style>
    .pricing-wrapper {
      display: flex;
      gap: 2rem;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .pricing-box {
      flex: 1 1 calc(20% - 2rem);
      box-sizing: border-box;
      min-width: 200px;
      max-width: 300px;
      text-align: center;
    }
    .inner-pricing-box {
      display: flex;
      flex-direction: column;
      min-height: 250px;
      padding: 2rem 1.5rem;
      border: none;
      border-radius: 4px;
      background-color: var(--bkg-grey-ultralight, #f5f5f5);
    }

    .inner-pricing-box.trial {
        border: #000 1px solid;
    }

    /* 4 Sections for each pricing box */
    .section-title,
    .section-description,
    .section-price {
      padding: 0.5rem 0;
      height: 8rem;
    }

    .section-button {
      padding: 0.5rem 0;
      height: 5rem;
    }

    /* Title Section */
    .section-title h2 {
      font-size: 1.6rem;
      margin: 0;
      font-weight: 400;
    }
    /* Description Section */
    .section-description p {
      margin: 0;
    }
    /* Price Section */
    .section-price .dollars {
      font-size: 2rem;
      margin: 0;
      font-weight: 600;
    }
    /* Button Section */
    .section-button button {
      display: block;
      padding: 10px 20px;
      font-size: 1.6rem;
      border: none;
      background-color: #1e90ff;
      color: #fff;
      cursor: pointer;
      border-radius: 4px;
      transition: background-color 0.3s ease, transform 0.3s ease;
      min-width: 150px;
      margin: 0 auto;
    }
    .section-button button:hover {
      background-color: #0c70d2;
      transform: scale(1.05);
    }

    .license-explainer {
        flex: 1 1 100%;
        max-width: 800px;
        text-align: center;
        margin-top: 2rem;
        font-style: italic;
        margin-left: auto;
        margin-right: auto;
    }

    @media (max-width: 768px) {
      .pricing-wrapper {
        flex-direction: column;
      }
      .pricing-box {
        flex: 1 1 100%;
      }
    }
  </style>
  
  <div style="margin-top: 20rem; margin-bottom: 5rem;">
    <h3 style="text-align: center; margin-bottom: 10rem;">
        Choose the license that's right for your team
    </h3>
    <div id="fetchingDiv" style="text-align: center; margin-bottom: 2rem;">⏳ Fetching pricing data...</div>
    <section class="section-container" style="padding: 0 0 4rem 0;">
      <div class="pricing-wrapper">
        <!-- Trial Box -->
        <div class="pricing-box">
          <p class="lead">Try for free</p>
          <div class="inner-pricing-box trial">
            <div class="section-title">
              <h2>Free Trial</h2>
            </div>
            <div class="section-description">
              <p>30 days for free<br>No credit card required</p>
            </div>
            <div class="section-price">
              <p class="dollars"></p>
            </div>
            <div class="section-button">
              <button>Request trial</button>
            </div>
          </div>
        </div>
        <!-- Individual Use Box -->
        <div class="pricing-box">
          <p class="lead">For individual use</p>
          <div class="inner-pricing-box">
            <div class="section-title">
              <h2>Run Eagle Eyes on 1 device</h2>
            </div>
            <div class="section-description">
              <p>1 year<br>No auto-renewal</p>
            </div>
            <div class="section-price">
              <p class="dollars"></p>
            </div>
            <div class="section-button">
              <button>Buy</button>
            </div>
          </div>
        </div>
        <!-- Small Teams Box -->
        <div class="pricing-box">
          <p class="lead">For small teams</p>
          <div class="inner-pricing-box">
            <div class="section-title">
              <h2>Run Eagle Eyes on up to 4 devices</h2>
            </div>
            <div class="section-description">
              <p>1 year<br>No auto-renewal</p>
            </div>
            <div class="section-price">
              <p class="dollars"></p>
            </div>
            <div class="section-button">
              <button>Buy</button>
            </div>
          </div>
        </div>
        <!-- Larger Teams Box -->
        <div class="pricing-box">
          <p class="lead">For larger teams</p>
          <div class="inner-pricing-box">
            <div class="section-title">
              <h2>Run Eagle Eyes on up to 10 devices</h2>
            </div>
            <div class="section-description">
                <p>1 year<br>No auto-renewal</p>
            </div>
            <div class="section-price">
              <p class="dollars"></p>
            </div>
            <div class="section-button">
              <button>Buy</button>
            </div>
          </div>
        </div>
        <!-- Organizations Box -->
        <div class="pricing-box">
          <p class="lead">For organizations</p>
          <div class="inner-pricing-box">
            <div class="section-title">
              <h2>Run Eagle Eyes on 10+ devices</h2>
            </div>
            <div class="section-description">
              <p></p>
            </div>
            <div class="section-price">
              <p class="dollars">Custom pricing</p>
            </div>
            <div class="section-button">
              <button>Contact us</button>
            </div>
          </div>
        </div>
        <div class="license-explainer">
            Activation only requires a one-time sign-in. Once activated, the license becomes permanently tied to that device and cannot be transferred elsewhere. You won't need to sign in again until the license expires.
        </div>
      </div>
    </section>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        fetchPricingData();
    });
    
    function getIsEmulatorFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('is_emulator') === 'true';
    }
    
    const useLocalFirebaseEmulator = getIsEmulatorFromURL();
    const hostURL = useLocalFirebaseEmulator ? 
        'http://127.0.0.1:5001/eagleeyessearch/us-central1' : 
        'https://us-central1-eagleeyessearch.cloudfunctions.net';
    
    function fetchPricingData() {
        var fetch_url = hostURL + '/get_product_line';
        console.log("Fetch URL: " + fetch_url);
    
        $.ajax({
            url: fetch_url,
            method: 'GET',
            success: function(data) {
                console.log('Fetched pricing data:', data);
                updatePricingDisplay(JSON.parse(data));
                $('#fetchingDiv').hide();
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Error fetching pricing data:', textStatus, errorThrown);
                $('#fetchingDiv').text('❌ Error fetching pricing data from server');
            }
        });
    }

    function updatePricingDisplay(pricingData) {
        // Find the one-year licenses for each tier
        const oneYearLicenses = Object.values(pricingData).filter(item => 
            item.duration_days > 93 && // 1 year license
            (item.n_keys === 1 || item.n_keys === 4 || item.n_keys === 10) // Only the three categories we need
        );
        
        // Update individual price (1 key) - Box 2
        const individualPrice = oneYearLicenses.find(item => item.n_keys === 1);
        if (individualPrice) {
            document.querySelector('.pricing-box:nth-child(2) .dollars').textContent = 
                `USD $${individualPrice.price_usd}`;
            document.querySelector('.pricing-box:nth-child(2) .section-button button').setAttribute('data-product-id', individualPrice.id);
        }
        
        // Update small team price (4 keys) - Box 3
        const smallTeamPrice = oneYearLicenses.find(item => item.n_keys === 4);
        if (smallTeamPrice) {
            document.querySelector('.pricing-box:nth-child(3) .dollars').textContent = 
                `USD $${smallTeamPrice.price_usd}`;
            document.querySelector('.pricing-box:nth-child(3) .section-button button').setAttribute('data-product-id', smallTeamPrice.id);
        }
        
        // Update large team price (10 keys) - Box 4
        const largeTeamPrice = oneYearLicenses.find(item => item.n_keys === 10);
        if (largeTeamPrice) {
            document.querySelector('.pricing-box:nth-child(4) .dollars').textContent = 
                `USD $${largeTeamPrice.price_usd}`;
            document.querySelector('.pricing-box:nth-child(4) .section-button button').setAttribute('data-product-id', largeTeamPrice.id);
        }

        // Add click handlers to buttons
        document.querySelectorAll('.section-button button').forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                if (productId) {
                    document.dispatchEvent(new CustomEvent('priceSelected', { 
                        detail: { 
                            product_id: productId,
                            price: this.closest('.pricing-box').querySelector('.dollars').textContent,
                            name: this.closest('.pricing-box').querySelector('h2').textContent
                        }
                    }));
                    console.log(`Dispatched priceSelected event for product_id: ${productId}`);
                }
            });
        });
    }
  </script>