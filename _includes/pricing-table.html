<style>
    .pricing-wrapper {
      display: flex;
      gap: 2rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 3rem;
    }
    
    .pricing-box {
      flex: 0 0 calc(20% - 2rem);
      box-sizing: border-box;
      min-width: 220px;
      max-width: 320px;
      text-align: center;
      transition: transform 0.3s ease;
      width: calc(20% - 2rem);
    }
    
    .pricing-box:hover {
      transform: translateY(-10px);
    }
    
    .inner-pricing-box {
      display: flex;
      flex-direction: column;
      height: 380px;
      padding: 2.5rem 2rem;
      border: none;
      border-radius: 12px;
      background-color: #fff;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      transition: box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .pricing-box:hover .inner-pricing-box {
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
    }

    .inner-pricing-box.trial {
        border: 2px solid #1e90ff;
    }
    
    .inner-pricing-box.popular {
        border: none;
        background: linear-gradient(145deg, #ffffff, #f8fbff);
    }
    
    .popular-badge {
        position: absolute;
        top: 0;
        right: 0;
        background: #1e90ff;
        color: white;
        font-size: 0.8rem;
        padding: 0.4rem 1.2rem;
        border-bottom-left-radius: 8px;
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 10px rgba(30, 144, 255, 0.3);
    }

    /* 4 Sections for each pricing box */
    .section-title {
      padding: 0.7rem 0;
      height: 60px;  /* Fixed height */
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .section-description {
      padding: 0.7rem 0;
      height: 70px;  /* Fixed height */
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .section-price {
      padding: 0.7rem 0;
      height: 80px;  /* Fixed height */
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .section-button {
      padding: 0.5rem 0;
      height: 70px;  /* Fixed height */
      margin-top: auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Title Section */
    .section-title h2 {
      font-size: 1.7rem;
      margin: 0;
      font-weight: 600;
      color: #333;
      line-height: 1.3;
    }
    
    /* Description Section */
    .section-description p {
      margin: 0;
      color: #555;
      line-height: 1.6;
    }
    
    /* Price Section */
    .section-price .dollars {
      font-size: 2.2rem;
      margin: 0;
      font-weight: 700;
      color: #1e90ff;
    }
    
    .fetching-price {
        font-size: 1.5rem;
        opacity: 0.7;
        font-style: italic;
        color: #666;
    }
    
    /* Button Section */
    .section-button button {
      display: block;
      padding: 12px 24px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      background-color: #1e90ff;
      color: #fff;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
      min-width: 170px;
      margin: 0 auto;
      box-shadow: 0 4px 12px rgba(30, 144, 255, 0.25);
    }
    
    .section-button button:hover {
      background-color: #0c70d2;
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(30, 144, 255, 0.35);
    }
    
    .section-button .secondary-button {
      background-color: transparent;
      color: #1e90ff;
      border: 2px solid #1e90ff;
      box-shadow: none;
    }
    
    .section-button .secondary-button:hover {
      background-color: rgba(30, 144, 255, 0.08);
      color: #0c70d2;
      border-color: #0c70d2;
    }

    .lead {
        font-weight: 500;
        color: #555;
        font-size: 1.3rem;
        margin-bottom: 1rem;
        letter-spacing: 0.01em;
    }

    .license-explainer {
        flex: 1 1 100%;
        max-width: 800px;
        text-align: center;
        margin-top: 3rem;
        font-style: italic;
        margin-left: auto;
        margin-right: auto;
        color: #666;
        line-height: 1.6;
        padding: 1.5rem;
        /* background-color: rgba(245, 247, 250, 0.7); */
        border-radius: 10px;
    }

    @media (max-width: 768px) {
      .pricing-wrapper {
        flex-direction: row;
        justify-content: center;
      }
      .pricing-box {
        flex: 0 0 calc(100% - 2rem);
        width: calc(100% - 2rem);
        max-width: 320px;
        margin-bottom: 2rem;
      }
    }

    @media (max-width: 480px) {
      .pricing-wrapper {
        flex-direction: column;
        align-items: center;
      }
      .pricing-box {
        flex: 0 0 100%;
        width: 100%;
        max-width: 320px;
      }
    }

    /* Main heading */
    .pricing-header h2 {
        text-align: center;
        margin-bottom: 1rem;
        font-size: 3rem;
        font-weight: 600;
        color: #222;
        line-height: 1.2;
    }

    /* Subheading */
    .pricing-header p {
        text-align: center;
        max-width: 700px;
        margin: 0 auto 3rem;
        color: #555;
        font-size: 1.3rem;
        line-height: 1.6;
    }
</style>
  
  <div style="margin-top: 12rem; margin-bottom: 5rem;">
    <div class="pricing-header">
        <h2>Choose Your Plan</h2>
        <p>Select the license that's right for your team. All plans include full access to Eagle Eyes features.</p>
    </div>
    
    <!-- <div id="fetchingDiv" style="text-align: center; margin-bottom: 2rem;">⏳ Fetching pricing data...</div> -->
    <section class="section-container" style="padding: 0 0 4rem 0; margin-top: 8rem;">
      <div class="pricing-wrapper">
        <!-- Trial Box -->
        <div class="pricing-box">
          <p class="lead">Evaluate First</p>
          <div class="inner-pricing-box trial">
            <div class="section-title">
              <h2>Free Trial</h2>
            </div>
            <div class="section-description">
              <p>30 days for free<br>No credit card required</p>
            </div>
            <div class="section-price">
              <p class="dollars">$0</p>
            </div>
            <div class="section-button">
              <button class="secondary-button">Request trial</button>
            </div>
          </div>
        </div>
        <!-- Individual Use Box -->
        <div class="pricing-box">
          <p class="lead">For Individual Use</p>
          <div class="inner-pricing-box">
            <div class="section-title">
              <h2>Run Eagle Eyes on 1 device</h2>
            </div>
            <div class="section-description">
              <p>1 year license<br>No auto-renewal</p>
            </div>
            <div class="section-price">
              <p class="dollars"></p>
            </div>
            <div class="section-button">
              <button>Buy Now</button>
            </div>
          </div>
        </div>
        <!-- Small Teams Box -->
        <div class="pricing-box">
          <p class="lead">For Small Teams</p>
          <div class="inner-pricing-box popular">
            <div class="popular-badge">POPULAR</div>
            <div class="section-title">
              <h2>Run Eagle Eyes on up to 4 devices</h2>
            </div>
            <div class="section-description">
              <p>1 year license<br>No auto-renewal</p>
            </div>
            <div class="section-price">
              <p class="dollars"></p>
            </div>
            <div class="section-button">
              <button>Buy Now</button>
            </div>
          </div>
        </div>
        <!-- Larger Teams Box -->
        <div class="pricing-box">
          <p class="lead">For Larger Teams</p>
          <div class="inner-pricing-box">
            <div class="section-title">
              <h2>Run Eagle Eyes on up to 10 devices</h2>
            </div>
            <div class="section-description">
                <p>1 year license<br>No auto-renewal</p>
            </div>
            <div class="section-price">
              <p class="dollars"></p>
            </div>
            <div class="section-button">
              <button>Buy Now</button>
            </div>
          </div>
        </div>
        <!-- Organizations Box -->
        <div class="pricing-box">
          <p class="lead">For Organizations</p>
          <div class="inner-pricing-box">
            <div class="section-title">
              <h2>Run Eagle Eyes on 10+ devices</h2>
            </div>
            <div class="section-description">
              <p>Custom solutions<br>Enterprise support</p>
            </div>
            <div class="section-price">
              <p class="dollars">Custom pricing</p>
            </div>
            <div class="section-button">
              <button>Contact Us</button>
            </div>
          </div>
        </div>
        <div class="license-explainer">
            Activation only requires a one-time sign-in. Once activated, the license becomes permanently tied to that device and cannot be transferred elsewhere. You won't need to sign in again until the license expires.
        </div>
      </div>
    </section>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize each price box with loading text
        document.querySelectorAll('.pricing-box:nth-child(2) .dollars, .pricing-box:nth-child(3) .dollars, .pricing-box:nth-child(4) .dollars').forEach(element => {
            element.innerHTML = '<span class="fetching-price">⏳ Fetching price data...</span>';
        });
        
        // Hide the central loading message
        $('#fetchingDiv').hide();
        
        fetchPricingData();
    });
    
    function getIsEmulatorFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('is_emulator') === 'true';
    }
    
    const useLocalFirebaseEmulator = getIsEmulatorFromURL();
    const hostURL = useLocalFirebaseEmulator ? 
        'http://127.0.0.1:5001/eagleeyessearch/us-central1' : 
        'https://us-central1-eagleeyessearch.cloudfunctions.net';
    
    function fetchPricingData() {
        var fetch_url = hostURL + '/get_product_line';
        console.log("Fetch URL: " + fetch_url);
    
        $.ajax({
            url: fetch_url,
            method: 'GET',
            success: function(data) {
                console.log('Fetched pricing data:', data);
                updatePricingDisplay(JSON.parse(data));
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Error fetching pricing data:', textStatus, errorThrown);
                $('#fetchingDiv').show().text('❌ Error fetching pricing data from server');
                
                // Also update the individual pricing areas with error message
                document.querySelectorAll('.pricing-box:nth-child(2) .dollars, .pricing-box:nth-child(3) .dollars, .pricing-box:nth-child(4) .dollars').forEach(element => {
                    element.innerHTML = '<span class="fetching-price" style="color: #cc0000;">Price data unavailable</span>';
                });
            }
        });
    }

    function updatePricingDisplay(pricingData) {
        // Find the one-year licenses for each tier
        const oneYearLicenses = Object.values(pricingData).filter(item => 
            item.duration_days > 93 && // 1 year license
            (item.n_keys === 1 || item.n_keys === 4 || item.n_keys === 10) // Only the three categories we need
        );
        
        // Update individual price (1 key) - Box 2
        const individualPrice = oneYearLicenses.find(item => item.n_keys === 1);
        if (individualPrice) {
            document.querySelector('.pricing-box:nth-child(2) .dollars').textContent = 
                `USD $${individualPrice.price_usd}`;
            document.querySelector('.pricing-box:nth-child(2) .section-button button').setAttribute('data-product-id', individualPrice.id);
        }
        
        // Update small team price (4 keys) - Box 3
        const smallTeamPrice = oneYearLicenses.find(item => item.n_keys === 4);
        if (smallTeamPrice) {
            document.querySelector('.pricing-box:nth-child(3) .dollars').textContent = 
                `USD $${smallTeamPrice.price_usd}`;
            document.querySelector('.pricing-box:nth-child(3) .section-button button').setAttribute('data-product-id', smallTeamPrice.id);
        }
        
        // Update large team price (10 keys) - Box 4
        const largeTeamPrice = oneYearLicenses.find(item => item.n_keys === 10);
        if (largeTeamPrice) {
            document.querySelector('.pricing-box:nth-child(4) .dollars').textContent = 
                `USD $${largeTeamPrice.price_usd}`;
            document.querySelector('.pricing-box:nth-child(4) .section-button button').setAttribute('data-product-id', largeTeamPrice.id);
        }

        // Add click handlers to buttons
        document.querySelectorAll('.section-button button').forEach(button => {
            button.addEventListener('click', function() {
                const productId = this.getAttribute('data-product-id');
                if (productId) {
                    document.dispatchEvent(new CustomEvent('priceSelected', { 
                        detail: { 
                            product_id: productId,
                            price: this.closest('.pricing-box').querySelector('.dollars').textContent,
                            name: this.closest('.pricing-box').querySelector('h2').textContent
                        }
                    }));
                    console.log(`Dispatched priceSelected event for product_id: ${productId}`);
                }
            });
        });
    }
  </script>