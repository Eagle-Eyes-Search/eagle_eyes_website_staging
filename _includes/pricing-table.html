<style>
    .pricing-wrapper {
      display: flex;
      gap: 2rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 3rem;
      width: 95%; /* Increased from default to ensure content fits on mobile */
      max-width: 1400px; /* Set a max-width for larger screens */
      margin-left: auto;
      margin-right: auto;
    }
    
    .pricing-box {
      flex: 0 0 calc(20% - 2rem);
      box-sizing: border-box;
      min-width: 200px;
      max-width: 320px;
      text-align: center;
      transition: transform 0.3s ease;
      width: calc(20% - 2rem);
    }
    
    .pricing-box:hover {
      transform: translateY(-10px);
    }
    
    .inner-pricing-box {
      display: flex;
      flex-direction: column;
      height: 380px;
      padding: 2.5rem 2rem;
      border: none;
      border-radius: 12px;
      background-color: #fff;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.08);
      transition: box-shadow 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .pricing-box:hover .inner-pricing-box {
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.12);
    }

    .inner-pricing-box.trial {
        border: 2px solid #000000;
    }
    
    .inner-pricing-box.popular {
        border: none;
        background: linear-gradient(145deg, #ffffff, #f8fbff);
    }
    
    .popular-badge {
        position: absolute;
        top: 0;
        right: 0;
        background: var(--blue-highlight);
        color: white;
        font-size: 0.8rem;
        padding: 0.4rem 1.2rem;
        border-bottom-left-radius: 8px;
        font-weight: 600;
        letter-spacing: 0.5px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    /* 4 Sections for each pricing box */
    .section-title {
      padding: 0.7rem 0;
      height: 60px;  /* Fixed height */
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .section-description {
      padding: 0.7rem 0;
      height: 70px;  /* Fixed height */
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .section-price {
      padding: 0.7rem 0;
      height: 80px;  /* Fixed height */
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .section-button {
      padding: 0.5rem 0;
      height: 70px;  /* Fixed height */
      margin-top: auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Title Section */
    .section-title h2 {
      font-size: 1.7rem;
      margin: 0;
      font-weight: 600;
      color: #333;
      line-height: 1.3;
    }
    
    /* Description Section */
    .section-description p {
      margin: 0;
      color: #555;
      line-height: 1.6;
    }
    
    /* Price Section */
    .section-price .dollars {
      font-size: 2.2rem;
      margin: 0;
      font-weight: 700;
      color: #000000;
    }
    
    .fetching-price {
        font-size: 1.5rem;
        opacity: 0.7;
        font-style: italic;
        color: #666;
    }
    
    /* Button Section */
    .section-button button {
      display: block;
      padding: 12px 24px;
      font-size: 1.1rem;
      font-weight: 600;
      border: none;
      background-color: #000000;
      color: #fff;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
      min-width: 170px;
      margin: 0 auto;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
    }
    
    .section-button button:hover {
      background-color: #333333;
      transform: translateY(-3px);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.35);
    }
    
    .section-button .secondary-button {
      background-color: transparent;
      color: #000000;
      border: 2px solid #000000;
      box-shadow: none;
    }
    
    .section-button .secondary-button:hover {
      background-color: rgba(0, 0, 0, 0.08);
      color: #333333;
      border-color: #333333;
    }

    .lead {
        font-weight: 500;
        color: #555;
        font-size: 1.5rem;
        margin-bottom: 1rem;
        letter-spacing: 0.01em;
        font-family: inherit;
    }

    .license-explainer {
        flex: 1 1 100%;
        max-width: 800px;
        text-align: center;
        margin-top: 3rem;
        font-style: italic;
        margin-left: auto;
        margin-right: auto;
        color: #666;
        line-height: 1.6;
        padding: 1.5rem;
        /* background-color: rgba(245, 247, 250, 0.7); */
        border-radius: 10px;
    }

    @media (max-width: 768px) {
      .pricing-wrapper {
        flex-direction: row;
        justify-content: center;
        width: 98%; /* Take up more width on smaller screens */
        gap: 1.5rem; /* Reduce the gap for better fit */
      }
      .pricing-box {
        flex: 0 0 calc(100% - 1.5rem);
        width: calc(100% - 1.5rem);
        max-width: 100%; /* Allow cards to expand to container width */
        margin-bottom: 1.5rem;
      }
      .inner-pricing-box {
        padding: 2rem 1.5rem; /* Slightly reduce padding */
      }
    }

    @media (max-width: 480px) {
      .pricing-wrapper {
        flex-direction: column;
        align-items: center;
        width: 95%; /* Slightly narrower than parent */
      }
      .pricing-box {
        flex: 0 0 100%;
        width: 100%;
        max-width: 100%;
      }
      .inner-pricing-box {
        padding: 1.8rem 1.2rem; /* Further reduce padding */
      }
      .section-title h2 {
        font-size: 1.5rem; /* Slightly reduce font size */
      }
      .lead {
        font-size: 1.3rem; /* Slightly reduce font size */
      }
    }

    /* Main heading - match with "Eagle Eyes Pilot for Android" on index.html */
    .pricing-header h2 {
        /* Reset any custom styling */
        text-align: center;
        margin-bottom: 30px; /* mb-30 equivalent */
        font-weight: inherit; /* Use the default h2 weight from your main stylesheet */
        font-size: inherit; /* Use the default h2 size from your main stylesheet */
        color: inherit; /* Use the default h2 color from your main stylesheet */
        line-height: inherit;
        letter-spacing: inherit;
    }

    /* Subheading - increase size and ensure font consistency */
    .pricing-header p {
        text-align: center;
        max-width: 800px;
        margin: 0 auto 3rem;
        color: #555;
        font-size: 1.5rem;
        line-height: 1.6;
        font-weight: 400;
        font-family: inherit;
    }
</style>
  
  <div style="margin-top: 14rem; margin-bottom: 5rem;">
    <div class="pricing-header">
        <h2 style="margin-bottom: 30px; font-weight: 300; font-size: 2.8rem; color: #333; line-height: 1.2; text-align: center;">Choose Your Plan</h2>
        <p>Select the license that's right for your team. All plans include full access to all Eagle Eyes products and features.</p>
    </div>
    
    <!-- <div id="fetchingDiv" style="text-align: center; margin-bottom: 2rem;">‚è≥ Fetching pricing data...</div> -->
    <section class="section-container" style="padding: 0 0 4rem 0; margin-top: 8rem; max-width: 1400px; margin-left: auto; margin-right: auto;">
      <div class="pricing-wrapper">
        <!-- Trial Box -->
        <div class="pricing-box">
          <p class="lead">Evaluate First</p>
          <div class="inner-pricing-box trial">
            <div class="section-title">
              <h2>Free Trial</h2>
            </div>
            <div class="section-description">
              <p>30 days for free<br>No credit card required</p>
            </div>
            <div class="section-price">
              <p class="dollars">$0</p>
            </div>
            <div class="section-button">
              <button class="secondary-button">Request trial</button>
            </div>
          </div>
        </div>
        <!-- Individual Use Box -->
        <div class="pricing-box">
          <p class="lead">For Individual Use</p>
          <div class="inner-pricing-box">
            <div class="section-title">
              <h2>Run Eagle Eyes on 1 device</h2>
            </div>
            <div class="section-description">
              <p>1 year license<br>No auto-renewal</p>
            </div>
            <div class="section-price">
              <p class="dollars"></p>
            </div>
            <div class="section-button">
              <button>Continue</button>
            </div>
          </div>
        </div>
        <!-- Small Teams Box -->
        <div class="pricing-box">
          <p class="lead">For Small Teams</p>
          <div class="inner-pricing-box popular">
            <div class="popular-badge">POPULAR</div>
            <div class="section-title">
              <h2>Run Eagle Eyes on up to 4 devices</h2>
            </div>
            <div class="section-description">
              <p>1 year license<br>No auto-renewal</p>
            </div>
            <div class="section-price">
              <p class="dollars"></p>
            </div>
            <div class="section-button">
              <button>Continue</button>
            </div>
          </div>
        </div>
        <!-- Larger Teams Box -->
        <div class="pricing-box">
          <p class="lead">For Larger Teams</p>
          <div class="inner-pricing-box">
            <div class="section-title">
              <h2>Run Eagle Eyes on up to 10 devices</h2>
            </div>
            <div class="section-description">
                <p>1 year license<br>No auto-renewal</p>
            </div>
            <div class="section-price">
              <p class="dollars"></p>
            </div>
            <div class="section-button">
              <button>Continue</button>
            </div>
          </div>
        </div>
        <!-- Organizations Box -->
        <div class="pricing-box">
          <p class="lead">For Organizations</p>
          <div class="inner-pricing-box">
            <div class="section-title">
              <h2>Run Eagle Eyes on 10+ devices</h2>
            </div>
            <div class="section-description">
              <p>Custom solutions<br>Enterprise support</p>
            </div>
            <div class="section-price">
              <p class="dollars">Custom pricing</p>
            </div>
            <div class="section-button">
              <button>Contact Us</button>
            </div>
          </div>
        </div>          
        <div class="license-explainer">
          A verified account is required to purchase a license. Account verification can take 1-3 business days.<br><br>
          A purchased license can be used on any supported device. Once a device is activated using a license, the device becomes permanently linked to that license and cannot be replaced with a different device. 
        </div>
      </div>
    </section>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize each price box with loading text
        document.querySelectorAll('.pricing-box:nth-child(2) .dollars, .pricing-box:nth-child(3) .dollars, .pricing-box:nth-child(4) .dollars').forEach(element => {
            element.innerHTML = '<span class="fetching-price">‚è≥ Fetching price data...</span>';
        });
        
        // Hide the central loading message
        $('#fetchingDiv').hide();
        
        fetchPricingData();
    });
    
    function getIsEmulatorFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('is_emulator') === 'true';
    }
    
    const useLocalFirebaseEmulator = getIsEmulatorFromURL();
    const hostURL = useLocalFirebaseEmulator ? 
        'http://127.0.0.1:5001/eagleeyessearch/us-central1' : 
        'https://us-central1-eagleeyessearch.cloudfunctions.net';
    
    function fetchPricingData() {
        var fetch_url = hostURL + '/get_product_line';
        console.log("Fetch URL: " + fetch_url);

        $.ajax({
            url: fetch_url,
            method: 'GET',
            success: function(data) {
                console.log('Fetched pricing data:', data);
                // Assuming the cloud function returns a JSON string
                try {
                    updatePricingDisplay(JSON.parse(data)); 
                } catch (e) {
                    // If it's already an object (e.g., emulator behaves differently)
                    if (typeof data === 'object' && data !== null) {
                        updatePricingDisplay(data);
                    } else {
                        console.error('Error parsing pricing data:', e);
                        handlePricingError(); // Call centralized error handler
                    }
                }
            },
            error: function(jqXHR, textStatus, errorThrown) {
                console.error('Error fetching pricing data:', textStatus, errorThrown);
                handlePricingError(); // Call centralized error handler
            }
        });
    }

    function handlePricingError() {
        $('#fetchingDiv').show().text('‚ùå Error fetching pricing data from server');
        // Also update the individual pricing areas with error message
        document.querySelectorAll('.pricing-box:nth-child(n+2):nth-child(-n+4) .dollars').forEach(element => {
            element.innerHTML = '<span class="fetching-price" style="color: #cc0000;">Price data unavailable</span>';
        });
    }

    function updatePricingDisplay(pricingData) {
        // Find the one-year licenses and keep their IDs
        const oneYearLicenses = Object.entries(pricingData)
            .filter(([id, item]) => 
                item.duration_days > 93 && 
                (item.n_keys === 1 || item.n_keys === 4 || item.n_keys === 10)
            )
            .map(([id, item]) => ({...item, id: id}));
        
        // Update individual price (1 key) - Box 2
        const individualPrice = oneYearLicenses.find(item => item.n_keys === 1);
        if (individualPrice) {
            const priceElement = document.querySelector('.pricing-box:nth-child(2) .dollars');
            const buttonElement = document.querySelector('.pricing-box:nth-child(2) .section-button button');
            priceElement.textContent = `USD $${individualPrice.price_usd}`;
            buttonElement.setAttribute('data-product-id', individualPrice.id);
            buttonElement.setAttribute('data-product-name', individualPrice.name);
            buttonElement.setAttribute('data-price', individualPrice.price_usd);
        }
        
        // Update small team price (4 keys) - Box 3
        const smallTeamPrice = oneYearLicenses.find(item => item.n_keys === 4);
        if (smallTeamPrice) {
            const priceElement = document.querySelector('.pricing-box:nth-child(3) .dollars');
            const buttonElement = document.querySelector('.pricing-box:nth-child(3) .section-button button');
            priceElement.textContent = `USD $${smallTeamPrice.price_usd}`;
            buttonElement.setAttribute('data-product-id', smallTeamPrice.id);
            buttonElement.setAttribute('data-product-name', smallTeamPrice.name);
            buttonElement.setAttribute('data-price', smallTeamPrice.price_usd);
        }
        
        // Update large team price (10 keys) - Box 4
        const largeTeamPrice = oneYearLicenses.find(item => item.n_keys === 10);
        if (largeTeamPrice) {
            const priceElement = document.querySelector('.pricing-box:nth-child(4) .dollars');
            const buttonElement = document.querySelector('.pricing-box:nth-child(4) .section-button button');
            priceElement.textContent = `USD $${largeTeamPrice.price_usd}`;
            buttonElement.setAttribute('data-product-id', largeTeamPrice.id);
            buttonElement.setAttribute('data-product-name', largeTeamPrice.name);
            buttonElement.setAttribute('data-price', largeTeamPrice.price_usd);
        }

        // Add click handlers to all buttons
        document.querySelectorAll('.pricing-box').forEach((box, index) => {
            const button = box.querySelector('.section-button button');
            
            switch(index) {
                case 0: // First box (Trial)
                    button.addEventListener('click', function() {
                        window.location.href = getUrlWithEmulatorParam('account.html?reason=trial');
                    });
                    break;
                    
                case 1: // Individual Use
                case 2: // Small Teams
                case 3: // Larger Teams
                    button.addEventListener('click', function() {
                        const productId = this.getAttribute('data-product-id');
                        if (productId) {
                            window.location.href = getUrlWithEmulatorParam(`account.html?reason=purchase&product=${productId}`);
                        }
                    });
                    break;
                    
                case 4: // Organizations (last box)
                    button.addEventListener('click', function() {
                        window.scrollTo({
                            top: document.documentElement.scrollHeight,
                            behavior: 'smooth'
                        });
                    });
                    break;
            }
        });
    }

    // Helper function to preserve emulator parameter
    function getUrlWithEmulatorParam(url) {
        const isEmulator = new URLSearchParams(window.location.search).get('is_emulator') === 'true';
        if (!isEmulator) return url;
        
        const separator = url.includes('?') ? '&' : '?';
        return url.includes('is_emulator=true') ? url : `${url}${separator}is_emulator=true`;
    }
  </script>