{% include pricing_table.html %}

<script>

document.addEventListener('DOMContentLoaded', function() {
    fetch('../data/pricing_data.json')
        .then(response => response.json())
        .then(data => {
            populatePricingTable(data.pricing);
        })
        .catch(error => console.error('Error loading pricing data:', error));
});

// Whenever a price option is clicked and thus selected, 
// a custom event priceSelected is dispatched with the price details. 
function populatePricingTable(pricingData) {
    const container = document.getElementById('pricing-rows-container');
    pricingData.forEach((item, index) => {
        const row = document.createElement('div');
        row.className = 'pricing-row';

        // Create keys container with clickable label
        const keysDiv = document.createElement('div');
        keysDiv.className = 'keys';
        keysDiv.textContent = item.keys;
        row.appendChild(keysDiv);

        // Add columns with conditions
        ['one-week', 'three-months', 'one-year'].forEach(term => {
            const div = document.createElement('div');
            div.textContent = item[term];
            if (item[term] !== '-') {
                div.className = 'clickable';
                div.addEventListener('click', function() {
                    // Remove selected from all
                    document.querySelectorAll('.clickable.selected').forEach(e => e.classList.remove('selected'));
                    // Add selected to clicked one
                    div.classList.add('selected');

                    // Dispatch a custom event with the selected price as detail
                    document.dispatchEvent(new CustomEvent('priceSelected', { detail: { price: item[term] } }));
                });
            }
            row.appendChild(div);
        });

        container.appendChild(row);
    });
}
</script>