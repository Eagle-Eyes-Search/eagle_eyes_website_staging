<!DOCTYPE html>
<html>


<head>
	<meta charset="UTF-8" />
	<meta content="width=device-width,initial-scale=1.0,maximum-scale=1.0" name="viewport">

	<!-- Open Graph -->
	<meta property="og:title" content="Eagle Eyes" />
	<meta property="og:url" content="https://www.eagleeyessearch.com/" />
	<meta property="og:type" content="website" />
	<meta property="og:image" content="https://eagleeyessearch.com/images/eagle_eyes_logo_2.png" />
	<meta property="og:description" content="The Future of Aerial Search" />

	<!-- Twitter Theme -->
	<meta name="twitter:widgets:theme" content="light">
	
	<!-- Title &amp; Favicon -->
	<title>Eagle Eyes Search</title>
	<link rel="apple-touch-icon" sizes="180x180" href="images/favicon/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="images/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="images/favicon/favicon-16x16.png">
	<link rel="manifest" href="images/favicon/site.webmanifest">
	<link rel="mask-icon" href="images/favicon/safari-pinned-tab.svg" color="#5bbad5">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#ffffff">

	<!-- Font -->
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700%7CHind+Madurai:400,500&amp;subset=latin-ext" rel="stylesheet">
	
	<!-- Css -->
	<link rel="stylesheet" href="css/core.min.css" />
	<link rel="stylesheet" href="css/skin.css" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
	<link rel="shortcut icon" type="image/png" href="images/eagle_eyes_icon_rounded_filtered.png">
	<link rel="stylesheet" href="css/custom-styling.css" />

    <style>
        .content-grid-3 {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
    </style>

	<!--[if lt IE 9]>
    	<script type="text/javascript" src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	
	<!-- Enable Fathom -->
	<script src="https://cdn.usefathom.com/script.js" data-site="QAODRYUQ" defer></script>
	
	<!-- Hotjar Tracking Code for Site 5045439 (name missing) -->
	<script>
		(function(h,o,t,j,a,r){
			h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
			h._hjSettings={hjid:5045439,hjsv:6};
			a=o.getElementsByTagName('head')[0];
			r=o.createElement('script');r.async=1;
			r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
			a.appendChild(r);
		})(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
	</script>
	<script>
	$(document).ready(function() {
		$('nav.overlay-navigation a').click(function() {
			$('.overlay-navigation-wrapper').hide(); // this will hide the element
			$('body').css('overflow', 'auto');
			$('html').css('overflow', 'auto');
			$('body').removeClass('no-scroll');
			$('html').removeClass('no-scroll');
			// Hacky stuff
			// or
			//$('.v-align-middle').removeClass('v-align-middle'); // this will remove the class
		});
	});
	</script>

</head>

<head>
  <!-- Add necessary meta tags and other head elements here -->

  <style>
    .banner {
      position: relative;
      height: 100px; /* Adjust as needed */
      width: 100%;
      overflow: hidden; /* to contain the pseudo element */
    }
  
    .banner::before {
      content: "";
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: url('/images/eagle_eyes_website_header_bg.jpg') no-repeat center;
      background-size: cover;
      filter: brightness(50%);
      z-index: 1; /* to ensure it's below other content */
    }
  
    .banner-text, .banner-img {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 2; /* to ensure it's above the background */
    }
   .banner-link img {
      width: 100px; /* adjust as per requirement */
      height: 50px;
       align-content: flex-start;
       z-index: 2;
       position: absolute;
       top: 20%;
    }
  
    /* Modern looking font */
    .lead {
      width: 80%;
      margin: auto;
      font: 1.2em/1.5em "Hind Madurai", sans-serif;
    }
    </style>
</head>

<body class="shop home-page">
  <div class="banner">
    <a class="banner-link" href="/">
      <img src="/images/back_to_eagleeyes.png"/>
    </a>
    <!-- <div class="banner-text">Eagle Eyes Scan</div> -->
    <img class="banner-img" src="/images/eagle_eyes_flat_logo_2.png" style="width:30%"/>
  </div>
    
  <section class="content evensection">
      <div class="lead">
        <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download Eagle Eyes Scan</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="custom-stylesheet" href="/css/form_buttons_and_boxes.css?t=[timestamp]">
    <style>

    html, body {
        width: 100%;
        margin: 0;
        padding: 0;
        box-sizing: border-box; /* Ensures padding does not affect the width */
    }

    .form-container {
        background: white;
        padding: 20px; /* This padding affects the inner content width */
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        width:100%;
        max-width: 750px;
        margin: 0 auto 50px;
        transition: width 0.3s ease-in-out;
    }

    .checkbox-container {
        margin-bottom: 5px;
    }

    h1 {
        color: #333;
        font-size: 24px;
    }

    p {
        font-size: 16px;
        color: #666;
    }

    label {
        font-size: 16px;
        color: #333;
        display: block;
        width: 100%; /* Ensure labels take the full available width */
    }
   
    input[type="text"],
    input[type="url"],
    input[type="email"],
    textarea {
        width: calc(97%); 
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    input::placeholder, textarea::placeholder {
        color: #ccc;
        font-style: italic;
    }

    input:focus::placeholder, textarea:focus::placeholder {
        color: transparent;
    }

    .radio-group {
        margin-left: 20px;
    }

    .radio-group div {
        display: flex;
        align-items: center;
    }

    .radio-group label {
        margin-left: 5px;
        color: #666;
        font-size: 16px;
       

    }

    /*

    .radio-group {
        width: calc(100%); 
        margin: 10px 0 20px;
    }

    .radio-group label {
        margin-right: 20px;
        color: #666;
        font-size: 16px;
    }
    */

    button {
        background-color: #007BFF;
        color: white;
        border: none;
        padding: 10px 20px; /* Adjust padding to control the width indirectly */
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        display: block;
        width: auto; /* Auto width based on content and padding */
        margin: 0 auto 0 auto; /* Center the button */
    }

    button:hover {
        background-color: #0056b3;
    }

    #submit-container {
        display: flex;
        justify-content: center; /* Aligns horizontally */
        width: 100%; /* Ensures the section takes full width */
    }

    /* Responsive adjustment for smaller screens */
    @media (max-width: 768px) {
        .form-container {
            width: 100%; /* Full width on smaller screens */
        }
    }

    .required::before {
        content: "* ";
        color: red;
        font-weight: bold;
    }

</style>

</head>
<body>   
    <section id="signin-explainer" style="display: flex; justify-content: center; align-items: center;">
        <h1>Download Eagle Eyes Scan</h1>
        <br/>
    </section>
    <section id="signin" style="display: flex; justify-content: center; align-items: center;">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<!-- Include form_buttons_and_boxes.scss (it's in scss/form_buttons_and_boxes.scss) but we need to get it in liquid -->
<style src="/css/form_buttons_and_boxes.css"></style>
<link rel="stylesheet" href="/css/form_buttons_and_boxes.css">


<script>

    class SigninWidget {
        constructor(
            firebaseConfig,
            useLocalFirebaseEmulator = false,

        ) {
            this.useLocalFirebaseEmulator = useLocalFirebaseEmulator;
            this.firebaseConfig = firebaseConfig;
            firebase.initializeApp(firebaseConfig);
            // Upon initialization, call the function to initialize Firebase
            
            this._user = null;

            // Check if user is still signed in from a previous session
            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    this._user = user;
                    console.log("User is signed in", user);
                    this.updateUserDisplay(user);
                    this.fireSigninEvent(user);
                } else {
                    console.log("No user is signed in.");
                    this.completeEmailLinkSigninIfApplicable();
                }
            });


        }


        signInWithGoogle() {
            var provider = new firebase.auth.GoogleAuthProvider();
            provider.addScope('email');
            firebase.auth().signInWithPopup(provider).then((result) => {
                this._user = result.user;
                this.updateUserDisplay(this._user);
                this.fireSigninEvent(this._user);
            }).catch((error) => {
                console.error('Error during Google sign in: ', error);
            });
        }

        signInWithEmailLink(returnURL = null) {
            if (!returnURL) {
                returnURL = window.location.href;
            }
            var email = document.getElementById('email').value;
            var baseURL = window.location.origin;
            console.log('baseURL: ', baseURL);
            console.log('window.location.href: ', window.location.href);
            console.log('returnURL: ', returnURL);
            var actionCodeSettings = {
                // Make sure this URL is the URL of the page where you will handle the sign-in link
                // url: `${baseURL}/get_licensed/?machine_id=${machineId}`,
                // Get the full url including args that this page was loaded with
                // url: window.location.href,
                // url: `${baseURL}/get_scan`,
                url: returnURL,
                handleCodeInApp: true
            };

            console.log("Sending action code to email: ", email, " with settings: ", actionCodeSettings);
            firebase.auth().sendSignInLinkToEmail(email, actionCodeSettings)
                .then(() => {
                    window.localStorage.setItem('emailForSignIn', email);

                    // Now, replace sign-in-div with an info box telling the user to check their email
                    var signInDiv = document.getElementById('sign-in-div');
                    signInDiv.innerHTML = 'Sign-in link sent to ' + email +
                        ".  Be sure to check your spam folder if you don't see it in your inbox." +
                        "<br/><br/>You can now close this tab.";

                    // And give it a light-blue background to draw attention
                    signInDiv.classList.add('info-box');

                    console.log('Sign-in email sent to ' + email);
                    // alert('Sign-in email sent to ' + email + ".  Be sure to check your spam folder if you don't see it in your inbox.");
                })
                .catch((error) => {
                    console.error('Error sending sign-in email: ', error);
                    // Append the error message in a div to the end of the body
                    var errorDiv = document.createElement('div');
                    errorDiv.innerHTML = 'Error sending sign-in email: ' + error.message;
                    errorDiv.classList.add('error-box');
                    document.body.appendChild(errorDiv);

                });

        }

        // Call this function on the page where users are redirected after clicking the sign-in link
        completeEmailLinkSigninIfApplicable() {
            // If user is not already signed in and the URL has a sign-in link
            if (firebase.auth().isSignInWithEmailLink(window.location.href)) {
                console.log('Email link sign-in detected');
                // Get the email if it's saved in local storage
                var email = window.localStorage.getItem('emailForSignIn');
                console.log('... with email: ', email);
                if (!email) {
                    // User opened the link on a different device. You will need to prompt them for their email
                    email = window.prompt('Please provide your email for confirmation');
                }

                firebase.auth().signInWithEmailLink(email, window.location.href)
                    .then((result) => {
                        console.log('Email Link sign in successful: ', JSON.stringify(result));
                        window.localStorage.removeItem('emailForSignIn'); // Clear the email from local storage

                        // var destringifiedUser = JSON.parse(JSON.stringify(result.user));
                        // console.log("destringifiedUser: ", JSON.stringify(destringifiedUser));
                        // User is signed in
                        this._user = result.user;
                        console.log('User signed in: ', this._user);
                        this.updateUserDisplay(this._user);
                        this.fireSigninEvent(this._user);
                        // checkLicence(); // Call checkLicence after successful login

                        // Optional: Redirect to another page after successful sign in
                    })
                    .catch((error) => {
                        console.error('Error during Email Link sign in: ', error);

                        // Make the sign-in div an error class and display the error
                        var signInDiv = document.getElementById('sign-in-div');
                        signInDiv.innerHTML = 'Error during Email Link sign in.  Most likely, the link has been used already or is expired.  Please try again, and contact info@eagleeyessearch.com if you continue to have trouble.';
                        signInDiv.classList.add('error-box');
                        // And add a button to reload the page without the user info attached
                        signInDiv.innerHTML += '<br/><button onclick="location.reload()"  class="non_important_button">Reload</button>';

                    });
            }
        }

        fireSigninEvent(user) {
            console.log('Firing signInComplete event with user: ', user);
            const event = new CustomEvent('signInComplete', { detail: { user: user } });
            document.dispatchEvent(event);
        }

        updateUserDisplay(user) {

            document.getElementById('user-info').innerHTML = 'Signed in as: ' + user.email + ' ( ' + user.displayName + ' )';
            // Give it that nice blue background by turning it into a .info-box
            document.getElementById('user-info').classList.add('info-box');
            document.getElementById('sign-in-div').style.display = 'none';
            // document.getElementById('user-info').innerHTML += '<br/><button onclick="location.reload()"  class="non_important_button">Change user</button>';
            // Need to sign-out now
            document.getElementById('user-info').innerHTML += '<br/><button onclick="signOutAndChangeUser()"  class="non_important_button">Change user</button>';
        }


        getUser() {
            return this._user;
        }
    }


    function signOutAndChangeUser() {
        firebase.auth().signOut().then(() => {
            console.log('User signed out.');
            // Reset the user display or redirect to the login page
            location.reload()
        }).catch((error) => {
            console.error('Sign out error', error);
        });
    }

    const signinWidget = new SigninWidget(
        {
            apiKey: "AIzaSyAL9w9qClktCNFM1XSfo_HB59nU6zHI0bk",
            authDomain: "eagleeyessearch.firebaseapp.com",
            projectId: "eagleeyessearch",
            storageBucket: "eagleeyessearch.appspot.com",
            messagingSenderId: "983592831720",
            appId: "1:983592831720:web:57b3880d0185ea3110575d",
            measurementId: "G-J057SPR81M"
        },
        false
    );

    function getIsEmulatorFromURL() {
        // Just see if there's an "is_emulator=true" in the URL
        var url = new URL(window.location.href);
        var isEmulator = url.searchParams.get("is_emulator");

        return isEmulator === "true";
    }

    function getHostUrl(){
                
        var useLocalFirebaseEmulator = getIsEmulatorFromURL();  // When running local emulator with "firebase emulators:start", set this to "true
        // var useLocalFirebaseEmulator = true;  // When running local emulator with "firebase emulators:start", set this to "true
        var hostURL = useLocalFirebaseEmulator ? 'http://127.0.0.1:5001/eagleeyessearch/us-central1' : 'https://us-central1-eagleeyessearch.cloudfunctions.net';
        console.log('useLocalFirebaseEmulator: ', useLocalFirebaseEmulator);
        console.log('hostURL: ', hostURL);
        
        return hostURL;
    }

    // document.addEventListener("DOMContentLoaded", function () {
    //     // Initialize menus to be hidden
    //     var menus = document.getElementsByClassName('menu-content');
    //     for (var i = 0; i < menus.length; i++) {
    //         menus[i].style.display = "none";
    //     }
    //     // onSelectLicenceToken();
    //     completeSignInWithEmailLinkIfApplicable();
    //     return;
    // });


    function showEmailInputBtn() {
        // Show the email sign-in form
        document.getElementById('email-sign-in-form').style.display = 'block';
        // Hide the initial button
        document.getElementById('showEmailInputBtn').style.display = 'none';
        // And the google-sign-in button
        document.getElementById('google-sign-in-btn').style.display = 'none';
        // Focus on the email input for user convenience
        document.getElementById('email').style.display = 'block'; // Make sure email input is visible
        document.getElementById('email').focus();
    }

</script>

<div id='sign-in-div'>


    <button id="google-sign-in-btn" onclick="signinWidget.signInWithGoogle()">Sign in with Google</button>
    or

    <div id="email-sign-in-form" style="display:none;">
        <input type="email" id="email" placeholder="Email" style="display:none;width:80%">

        <!-- Add a cancel button that just reloads this page from scratch -->
        <button onclick="location.reload()" class="non_important_button">Cancel</button>

        <button id="sendSignInLinkBtn" onclick="signinWidget.signInWithEmailLink()">Send Sign in Link</button>
    </div>
    <button id="showEmailInputBtn" onclick="showEmailInputBtn()">Sign In With Email</button>
    <!-- <script>
    document.addEventListener("DOMContentLoaded", function () {
        // Event listener for the button to show email input
        document.getElementById('showEmailInputBtn').addEventListener('click', function () {
            // Show the email sign-in form
            document.getElementById('email-sign-in-form').style.display = 'block';
            // Hide the initial button
            this.style.display = 'none';
            // And the google-sign-in button
            document.getElementById('google-sign-in-btn').style.display = 'none';
            // Focus on the email input for user convenience
            document.getElementById('email').style.display = 'block'; // Make sure email input is visible
            document.getElementById('email').focus();
        });

        // Attach the signInWithEmailLink function to the Send SignIn Link button
        // document.getElementById('sendSignInLinkBtn').addEventListener('click', function () {
        //     signInWithEmailLink();
        // });
    });

</script> -->
</div>
<p id="user-info"></p>
    </section>

    <section id="form-container" class="form-container" hidden>
        <h1 style="text-align: center;">Download Eagle Eyes Scan</h1>
        <p style="text-align: center;">Complete this short form, and you'll receive your download link immediately.</p>
    <!-- Don't forget to include form_styling in document head -->

    <section id="form">
        <p style="text-align: center;"><i>* required information</i></p>
        <form id="fields">
            <label for="name" class="required"><b>Name:</b> Your full name</label>
            <input type="text" id="name" name="name" placeholder="Firstname Lastname" style="margin-bottom: 15px; margin-top: 0px;" required>

            <label for="team" class="required"><b>Organization Name:</b> Your team/company/agency, or enter "Individual" if you are not part of an organization</label>
            <input type="text" id="team" name="team" placeholder="Enter your organization's name" style="margin-bottom: 15px; margin-top: 0px;" required>

            <label for="website" class="required"><b>Organization Website:</b></label>
            <input type="text" id="website" name="website" placeholder="http://www.example.com" style="margin-bottom: 15px; margin-top: 0px;" required>

            <label for="location" class="required"><b>Location:</b> City, State/Province, Country</label>
            <input type="text" id="location" name="location" placeholder="Example Springs, Examplebama, USA" style="margin-bottom: 15px; margin-top: 0px;" required>

            <label for="use-case" class="required">What are you interested in using Eagle Eyes for?</label>
            <textarea id="use-case" name="use_case" placeholder="To locate ... so I can ..." rows="4" required></textarea>

            

            <label for="questions"><b>Questions or remarks:</b> (optional)</label>
            <textarea id="questions" name="questions" placeholder="" rows="4" style="margin-bottom: 15px; margin-top: 0px;"></textarea>

            <div id="terms-of-use" class="info-box">
    
                <p style="text-align: center;"><b>Terms of Use</b></p>
                <ul style="font-size: 80%; font-style: italic;">
                    <li>The Eagle Eyes system does not replace human oversight. It may miss details that a human operator could catch. Operators should always review the raw footage personally.</li>
                    <li>Any licenses purchased in the future will be for internal use only and shall not be transferred, sold, or distributed to other organizations.</li>
                    <li>This software is intended to be used for search and rescue purposes only.</li>
                </ul>
            </div>
    
            <div class="checkboxes">
                <div class="checkbox-container">
                    <input type="checkbox" id="agree_terms" name="agree_terms" required>
                    <label for="agree_terms"><span class="checkbox-label required">I have read and agree to the Eagle Eyes Scan Terms of Use above.</span></label>
                </div>
                <div class="checkbox-container">
                    <input type="checkbox" id="receive_newsletter" name="receive_newsletter">
                    <label for="receive_newsletter"><span class="checkbox-label">I want to receive updates about Eagle Eyes Search.</span></label>
                </div>
            </div>
        </form>
    </section>

    <script>
            // This line enables Jekyll to pass the clickable parameter when including this file
        const formType = 'signup';
        
        var useLocalFirebaseEmulator = getIsEmulatorFromURL();  // When running local emulator with "firebase emulators:start", set this to "true
        var hostURL = useLocalFirebaseEmulator ? 'http://127.0.0.1:5001/eagleeyessearch/us-central1' : 'https://us-central1-eagleeyessearch.cloudfunctions.net';
        


        function getIsEmulatorFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            // return urlParams.get('is_emulator') === 'true';
            // Case insensitive
            return urlParams.get('is_emulator')?.toLowerCase() === 'true';
        }

        function requestErrorHandler(jqXHR, textStatus, errorThrown) {
            $("#hang-on-message").hide();
            console.log("Error: " + errorThrown);
            console.log("Status: " + textStatus);
            console.log("Response: " + jqXHR.responseText);
            showError("Error: " + errorThrown + " Status: " + textStatus + " Response: " + jqXHR.responseText);
        }

        function showError(message) {
            // Show an error message to the user
            var errorBox = document.createElement('div');
            errorBox.classList.add('error-box');
            // Width 80% of the screen
            errorBox.style.width = '80%';
            // Center horizontally
            errorBox.style.margin = '0 auto';

            errorBox.textContent = message;
            // Append to end of 'end-of-page' div
            // document.getElementById('end-of-page').appendChild(errorBox);
            document.body.appendChild(errorBox);

            // Show the "try again" button (try-again-button) (just make it not hidden)
            // $('#try-again-button').css('display', 'block');

            // Scroll to the bottom of the page
            window.scrollTo(0, document.body.scrollHeight);
        }

        function populateForm(formData) {
            // Get all form inputs
            var formInputs = document.querySelectorAll('input[type=text], input[type=password], input[type=checkbox], input[type=radio], select, textarea');
            
            // Iterate through each input in the form
            for (var i = 0; i < formInputs.length; i++) {
                var input = formInputs[i];

                // Check if the input's name exists in the formData
                if (formData.hasOwnProperty(input.name)) {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        // Set the checked property based on formData
                        input.checked = formData[input.name];
                    } else {
                        // Set the value property based on formData
                        input.value = formData[input.name];
                    }
                }
            }
        }

        function submitForm() {
            console.log('form type is: ' + formType);

            if (!validateForm()) {
                console.log("Form validation failed");
                $("#status").html("Please complete all required fields").show();
                return false; // Prevent form submission if validation fails
            }

            if (formType == 'register' || formType == 'trial') {
                console.log('launching processRegisterForm');
                processRegisterForm();
            } else if (formType == 'signup') {
                console.log('launching processSignupForm');
                processSignupForm();
            } else {
                console.log("Unknown form type: " + formType);
            }

            return true; // Allow form submission if validation passes

        }

        function validateForm() {
            var isValid = true;
            var requiredFields = document.querySelectorAll('#fields [required]');
            var radioGroups = {};

            requiredFields.forEach(function(field) {
                // Only process fields that have the 'required' attribute
                if (field.hasAttribute('required')) {
                    if (field.type === 'radio') {
                        if (!radioGroups[field.name]) {
                            radioGroups[field.name] = [];
                        }
                        radioGroups[field.name].push(field);
                    } else if (field.type === 'checkbox' && !field.checked) {
                        isValid = false;
                        field.nextElementSibling.style.color = 'red'; // Highlight invalid checkboxes
                    } else if (field.type !== 'checkbox' && field.type !== 'radio') {
                        if (!field.value.trim()) {
                            isValid = false;
                            field.style.borderColor = 'red'; // Highlight invalid text inputs
                        } else {
                            field.style.borderColor = ''; // Reset text input highlight
                        }
                    }
                }
            });

            // Validate radio button groups
            Object.keys(radioGroups).forEach(function(groupName) {
                var group = radioGroups[groupName];
                var groupIsValid = group.some(function(radio) {
                    return radio.checked;
                });

                if (!groupIsValid) {
                    isValid = false;
                    group.forEach(function(radio) {
                        radio.nextElementSibling.style.color = 'red'; // Highlight invalid radio group
                    });
                } else {
                    group.forEach(function(radio) {
                        radio.nextElementSibling.style.color = ''; // Reset radio group highlight
                    });
                }
            });

            return isValid;
        }

        function processRegisterForm() {
            // Add "processing" class to the submit button
            $("#submitButton").addClass('processing');

            // Pack the form data into an object
            var formData = {};
            var formInputs = document.querySelectorAll('input[name], select[name], textarea[name]');
            formInputs.forEach(function(input) {
                if (input.type === 'checkbox') {
                    formData[input.name] = input.checked ? 'yes' : 'no';
                } else if (input.type === 'radio') {
                    if (input.checked) {
                        formData[input.name] = input.value;
                    }
                } else {
                    formData[input.name] = input.value;
                }
            });

            console.log(formData);


            // Remove empty keys or invalid entries
            for (var key in formData) {
                if (formData[key] === null || formData[key] === undefined || formData[key].trim() === "") {
                    delete formData[key];
                }
            }

            if (formType == 'trial') {
                // Add the trial type to the form data
                formData['trial_request'] = true;
            } else {
                formData['trial_request'] = false;
            }

            console.log(formData);

            var fetch_url = hostURL + '/submit_register_form';

            console.log("Fetch URL: " + fetch_url);

            globalUser.getIdToken(true).then(function (idToken) {

                $.ajax({
                    url: fetch_url,
                    data: JSON.stringify(formData),
                    type: 'POST', // Changed from 'method' to 'type' for clarity, though both are acceptable. Use 'POST' since you're sending a body.
                    contentType: 'application/json', // This sets the Content-Type header to application/json
                    headers: {
                        'Authorization': 'Bearer ' + idToken
                    },
                    success: function (data) {
                        console.log("Success" + data);

                        // Remove "processing" class to the submit button
                        $("#submitButton").removeClass('processing');

                        // Show user message with link and ask them if they want to download
                        // If yes, then redirect to the link
                        // If no, then do nothing

                        // Hide the download button/div after submitting form
                        $("#form-container").hide();
                        $("#signin").hide();
                        $("#post-form").show();
                    },
                    error: function() {
                        // Remove "processing" class to the submit button
                        $("#submitButton").removeClass('processing');
                        requestErrorHandler();
                    }
                });
            });
        }

        // On load - check whether to show the emulator info box
        $(document).ready(function () {
            if (useLocalFirebaseEmulator) {
                $('#using-emulator-info').show();
            }
        });

        function processSignupForm() {

            // filePath = "gs://eagleeyessearch.appspot.com/scan_releases/EagleEyesScan_0.4.3_MacOS_arm64.zip"
            // filePath = "scan_releases/EagleEyesScan_0.4.3_MacOS_arm64.zip"

            var hostUrl = getHostUrl();
            var selectElement = document.getElementById('software_version');
            var filePath = "scan_releases/" + selectElement.value;
            var fetch_url = hostURL + '/generate_download_link?filePath=' + filePath;

            // Pack the form data into an object
            hasFormBeenShown = $("#form").is(":visible");
            console.log("Form has been shown?: " + hasFormBeenShown);
            var formData = {};
            if (hasFormBeenShown) {
                // Add "processing" class to the submit button
                $("#submitButton").addClass('processing');
                var formInputs = document.querySelectorAll('input[name], select[name], textarea[name]');
                formInputs.forEach(function(input) {
                    if (input.type === 'checkbox') {
                        formData[input.name] = input.checked ? 'yes' : 'no';
                    } else if (input.type === 'radio') {
                        if (input.checked) {
                            formData[input.name] = input.value;
                        }
                    } else {
                        formData[input.name] = input.value;
                    }
                });
            } 

            // Remove empty keys or invalid entries
            for (var key in formData) {
                if (formData[key] === null || formData[key] === undefined || formData[key].trim() === "") {
                    delete formData[key];
                }
            }

            statusSpan=$("#status");
            statusText = "Hang on a moment, download should start automatically...";
            console.log("Back up link: " + backUpLinkOrNull);
            if (backUpLinkOrNull !== null) {
                statusText += "If it doesn't, you can click <a href='" + backUpLinkOrNull + "'>here</a> to download it manually.";
            }
            statusSpan.html(statusText);

            console.log("Checking URL: " + fetch_url);
            console.log("Fetch URL: " + fetch_url);
            globalUser.getIdToken(true).then(function (idToken) {

                $.ajax({
                    url: fetch_url,
                    data: JSON.stringify(formData),
                    type: 'POST', // Changed from 'method' to 'type' for clarity, though both are acceptable. Use 'POST' since you're sending a body.
                    contentType: 'application/json', // This sets the Content-Type header to application/json
                    headers: {
                        'Authorization': 'Bearer ' + idToken
                    },
                    success: function (data) {
                        data = JSON.parse(data);
                        console.log("Success: " + data);
                        var downloadLink = data.url;
                        console.log("Download link: " + downloadLink);

                        // Remove "processing" class to the submit button
                        $("#submitButton").removeClass('processing');
                        // Show user message with link and ask them if they want to download
                        // If yes, then redirect to the link
                        // If no, then do nothing

                        // Hide the download button/div after submitting form
                        $("#download-button-div").hide();


                        window.location.href = downloadLink;
                        $("#signin").hide();
                        $("#form-container").hide();
                        $("#post-form").show();
                        $("#download-link").attr("href", downloadLink);
                        
                        // Fathom download-event tracking
                        fathom.trackEvent('download_scan', {
                            _value: 0,
                            download: filePath
                        });
                        
                        // Hotjar download-event tracking
                        // hj('event', 'download_' + filePath.replace(/[^a-zA-Z0-9]/g, '_'));
                        hj('event', 'download_scan');
                    },
                    error: function() {
                        // Remove "processing" class to the submit button
                        $("#submitButton").removeClass('processing');
                        requestErrorHandler();
                    }
                });
            });

        }


    </script>

    </section>

    <div style="display: flex; justify-content: center; align-items: center;" hidden>
        <div id="hang-on-message" class="info-box" ></div>
    </div>

    <div style="display: flex; justify-content: center; align-items: center;">
        <div id="welcome-back-message" class="info-box" hidden>
        </div>
    </div>

    <div id="download-button-div" hidden>

        <!-- Software version list-selection (list-selection that we populate in javascript) -->
        <div style="display: flex; justify-content: center; align-items: center;">
            <div>
                <label for="software_version"><b>Software version: </b>
                <select id="software_version" name="software_version" required>
                    <option value="" disabled selected>Select software version</option>
                </select></label>
            </div>
        </div>

        <br />
        <div style="display: flex; justify-content: center; align-items: center;">
            <div id="mac-support-message" style="max-width: 550px; text-align: center; font-size: 80%; font-style: italic; color: gray"></div>
        </div>
        <br/>

        <div style="display: flex; justify-content: center; align-items: center;">
            <button id="submitButton" type="submit" onclick="submitForm()">Submit and start download</button>
        </div>
        <div style="display: flex; justify-content: center; align-items: center;">
            <div id="status" style="font-size: 0.8em;color:lightgray;"></div>
        </div>
        <br />

        <!-- Tiny grey font -->

    </div>
    <!-- <button id="download-button" type="submit" class="registerbtn" hidden>Submit and start download</button> -->
    <br />



    <section id="post-form" class="info-box" hidden>
        Your download should have begun automatically.
        If it didn't, you can click <a id="download-link" href="">here</a> to download it manually.
        <br /><br />
        This download of Eagle Eyes Scan comes with a free license with useful but limited functionality.
        To enable the detection system, report generation, and livestreaming, you can request a full license 
        by clicking the "🔑" button from the app and follwing instructions from there.

        <br /><br />
        More questions? Consult the     <a
            href="https://docs.google.com/document/d/12mhRVmhtQUfvJHy7tI7mB_oLd3aRqYJJPWzKlhKnTwY/edit?usp=sharing">User Manual</a>.

        <!-- Add button to return to home page -->
        <br />
        <button onclick="location.href='/'" class="non_important_button">Return to home page</button>
    </section>

<br />
<br />
<div style="display: flex; justify-content: center; align-items: center;">
    <span style="font-size: 0.8em;color:lightgray;">
    Problems with signin or download? Contact us at info@eagleeyessearch.com
    </span>
</div>
<script>

        $("#hang-on-message").hide();

        var globalUser = null;

        var backUpLinkOrNull = null;
        console.log("Signin widget included");
        document.addEventListener('signInComplete', function (e) {
            /* Handle the event:
            CustomEvent('signInComplete', { detail: { user: user } })
            Generated by the signinWidget.html inclusion
            */
            globalUser = e.detail.user;
            console.log('signInComplete event received: ' + globalUser);
            // Send a request to the server to see if the user has already filled out the form. 
            // If they have not - show it, if they have, show a greeting message and the download link.
            hostURL = getHostUrl();
            var fetch_url = hostURL + '/has_user_already_filled_in_form';
            console.log("Checking URL: " + fetch_url);           
            $("#hang-on-message").text("Hang on a moment while we while we get everything ready for you...").show();
            globalUser.getIdToken(true).then(function (idToken) {
                $.ajax({
                    url: fetch_url,
                    type: 'GET',
                    headers: {

                        'Authorization': 'Bearer ' + idToken

                    },
                    success: function (data) {
                        $("#signin-explainer").hide();
                        $("#hang-on-message").hide();

                        console.log("Got reply from has_user_already_filled_in_form: " + data);
                        data = JSON.parse(data);
                        formOrNull = data.form
                        backUpLinkOrNull = data.backupLink;
                        if (formOrNull === null) {
                            console.log('user did not fill in form yet');
                            $("#form-container").show();
                            $("#download-button-div").show();
                        } else {
                            // Show a welcome back message with name and team 
                            console.log('user filled in form already');
                            userName = formOrNull.name || "(Unknown user)";
                            userTeam = formOrNull.team || "(Unknown team)";
                            $("#welcome-back-message").text("Welcome back. Your download link is below.");
                            $("#welcome-back-message").show();
                            // Set Download button text to "Downlaod again" (it's the only button in the div)
                            $("#download-button-div button").text("Download again");
                            $("#download-button-div").show()
                        }
                    },
                    error: requestErrorHandler,
                });
            });
        });



    window.addEventListener('DOMContentLoaded', function () {
        /*

        Software version list-selection (list-selection that we populate in javascript)
        <label for="software_version"><b>Software version: </b></label>
        <select id="software_version" name="software_version" required>
            <option value="" disabled selected>Select software version</option>
        </select>
        <br />
        */
        windowsDefault = 'EagleEyesScanInstaller_0.5.2rc1_Windows_x86_64.exe';
        macDefault = 'EagleEyesScan_0.5.2rc1_MacOS_arm64.zip';
        var softwareVersions = [
            //'EagleEyesScan_0.4.3_MacOS_arm64.zip',
            // 'EagleEyesScan_0.5.0rc2_MacOS_arm64.zip',
            // 'EagleEyesScan_0.5.0rc3_MacOS_arm64.zip',
            // 'EagleEyesScan_0.5.0rc4_MacOS_arm64.zip',
            // 'EagleEyesScan_0.5.0rc5_MacOS_arm64.zip',
            // 'EagleEyesScan_0.5.1rc8_MacOS_x86_64.zip',
            'EagleEyesScan_0.5.2rc1_MacOS_x86_64.zip',
            // 'EagleEyesScan_0.5.0rc7_MacOS_arm64.zip',
            // 'EagleEyesScan_0.4.3_Windows_x64.zip',
            //'EagleEyesScan_0.4.5_Windows_x86_64.zip',
            // 'EagleEyesScan_0.5.0rc2_Windows_x86_64.zip',
            // 'EagleEyesScan_0.5.0rc3_Windows_x86_64.zip',
            // 'EagleEyesScan_0.5.0rc4_Windows_x86_64.zip',
            // 'EagleEyesScan_0.5.0rc7_Windows_x86_64.zip',
            windowsDefault,
            macDefault,
        ];
        var selectElement = document.getElementById('software_version');
        var os = navigator.platform.toLowerCase();

        softwareVersions.forEach(function (version) {
            var optionElement = document.createElement('option');
            optionElement.value = version;
            optionElement.textContent = version;

            if (os.includes('mac') && (version === macDefault)) {
                optionElement.selected = true;
            } else if (os.includes('win') && (version === windowsDefault)) {
                optionElement.selected = true;
            }

            if (os.includes('mac') ) {
                    $("#mac-support-message").html("For Apple devices, we recommend installing on a device with ARM64 architecture (M1, M2, M3, or M4 chipsets). We do offer a distribution for Intel-based (x86) Mac OS systems, but performance may vary. Use at your own risk.").show();
            }

            selectElement.appendChild(optionElement);
        });
    });

</script>

</body>
      </div>
  </section>
  
</body>
</html>
