---
layout: ee_page_layout
title: Account
permalink: /account/
---

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Import JQuery libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <!-- Include Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>

    <!-- Include form_buttons_and_boxes.scss (it's in scss/form_buttons_and_boxes.scss) but we need to get it in liquid -->
    <style src="/css/form_buttons_and_boxes.css"></style>
    <link rel="stylesheet" href="/css/form_buttons_and_boxes.css">   
    
    
    

    <style>
        #accountpage {
            font-size: 14px;

        }

        .account_text {
            line-height: 1;
            margin-bottom: 35px;
        }

        .pricing_table table {
            border-collapse: collapse;
            border-spacing: 0;
            margin-bottom: 20px;
            width: 100%;
            max-width: 100%;
        } 

        .pricing_table th,
        .pricing_table td {
            font-size: 14px;
            padding: 10px;
            text-align: left;
            vertical-align: top;
        }

        .pricing_table th {
            color: #000000; 
            font-size: 16px; 
        }

        .pricing_table tr.selected {
            background: #ddd;
        }

        .border_table {
            overflow: auto;
            width: 70%;
        }

        .border_table table {
            border: 1px solid #dededf;
            height: 100%;
            width: 100%;
            table-layout: fixed;
            border-collapse: collapse;
            border-spacing: 1px;
            text-align: left;
        }

        .border_table th {
            border: 1px solid #dededf;
            background-color: #eceff1;
            color: #000000;
            padding: 5px;
        }

        .border_table td {
            border: 1px solid #dededf;
            background-color: #ffffff;
            color: #000000;
            padding: 5px;
        }

        #licenseTable th.expires_col, #licenseTable td.expires_col {
            width: 20%; /* Adjust width as necessary */
            max-width: 120px; /* Set a max-width if needed */
        }

        #licenseTable th.keys_col, #licenseTable td.keys_col {
            width: 20%; /* Adjust width as necessary */
            max-width: 120px; /* Set a max-width if needed */
        }
        
        #licenseTable th.license_col, #licenseTable td.license_col {
            width: 40%; /* Adjust the remaining width for the first column */
        }

    </style>
</head>

<body>
    <section id="signin">
        <div class="sign_in_text">

            <div class="info-box" id="using-emulator-info" style="display: none;">Using local Firebase emulator</div>

            <h1>Sign in or create a new account</h1>

            Enter your email address to sign in. If you're new, we'll automatically create an account for you.
        </div>
    </br>

    {% include signinWidget.html %}
    <span class="sign_in_text" style="font-size: 0.8em;color:lightgray;">
        </br>
        Problems with signin or download? Contact us at info@eagleeyessearch.com
    </span>
        <script>

            var globalUser = null;

            document.addEventListener('signInComplete', function (e) {
                /* Handle the event:
                CustomEvent('signInComplete', { detail: { user: user } })
                Generated by the signinWidget.html inclusion
                */
                globalUser = e.detail.user;
                console.log('signInComplete event received: ' + globalUser);

                // store email of user
                // var userEmail = globalUser.email;

                // Hide the temporary "checking licenses" box
                // $("#checking-licenses-box").hide();
                // Show the licenses section

                $(".sign_in_text").hide();
                $("#account_details").show();
                $("#purchases").show();
                $("#instructions").show();
                $("#downloads").show();
                $("#download-button-div").show(); 
                $("#licenses").show();
                }
            );
        </script>

    </section>

    <section id="accountpage">

        <div id="account_details" hidden>
            <p>Your account type: <span id="accountType">[account_type]</span></p>
        </div>

        <div class="account_text" id="purchases" hidden>
            <h2>Your purchases</h2>
            <p>Display purchase history here.</p>
        </div>

        <div class="account_text" id="instructions" hidden>
            <h2>Installation instructions</h2>
            <ul>
                <li>
                  <h3>Step 1: Download Eagle Eyes Scan</h3>
                  <p>Download the software below.</p>
                </li>
                <li>
                  <h3>Step 2: Activate license on your device</h3>
                  <p>Instructions on how to activate your device.</p>
                </li>
              </ul>
        </div>

        <div class="account_text" id="downloads" hidden>
            <h2>Your available downloads</h2>
            <p>Eagle Eyes Scan comes standard with a BASIC license.</p>
            <div id="download-button-div" hidden>

                <!-- Software version list-selection (list-selection that we populate in javascript) -->
                <label for="software_version"><b>Software version: </b></label>
                <select id="software_version" name="software_version" required>
                    <option value="" disabled selected>Select software version</option>
                </select>
                <br/>
                <button onclick="getDownloadLink()">Download</button>
                <br/>
                <span id="downloadStatus" style="font-size: 0.8em;color:lightgray;"></span>        
            </div>
        </div>

        <div class="account_text" id="licenses" hidden>
            <h2>Your licenses</h2>
            <div id="licenseTableContainer" class="border_table" tabindex="0">
                <table id="licenseTable">
                    <thead>
                        <tr>
                            <th class="license_col">License</th>
                            <th class="expires_col">Valid until</th>
                            <th class="keys_col">Available keys</th>
                        </tr>
                    </thead>
                    <tbody class="license_options">
                        <!-- Rows will be added here dynamically -->
                    </tbody>
                </table>
            </div>
        </br>
        <button id="activateButton" onclick="activateLicense()">Use a key of selected license on this device</button>

        </div>
    </section>

    <script>

        // function to add a row to the table for each license
        function populateTable() {
            const tableBody = document.getElementById('licenseTable').getElementsByTagName('tbody')[0];
            const activateButton = document.getElementById('activateButton');

            licenses.forEach((license, index) => {
                const row = document.createElement('tr');

                // create a cell for the tier and the radio button
                const tierCell = document.createElement('td');

                // create and configure the radio button
                const radioButton = document.createElement('input');
                radioButton.type = 'radio';
                radioButton.name = 'license_option';
                radioButton.value = license.available_tokens;  // Store available tokens as the value

                // Check and disable logic for button when radio is clicked
                radioButton.addEventListener('click', function() {
                    activateButton.disabled = this.value == 0;  // Disable button if 0 tokens available
                    activateButton.style.backgroundColor = this.value == 0 ? 'grey' : '';  // Change color if disabled
                });

                // Optionally, check the first radio button by default and set button state
                if (index === 0) {
                    radioButton.checked = true;
                    activateButton.disabled = license.available_tokens === 0;
                    activateButton.style.backgroundColor = license.available_tokens === 0 ? 'grey' : '';
                }

                tierCell.appendChild(radioButton);
                tierCell.appendChild(document.createTextNode('  '));   // text node for spacing
                const textNode = document.createTextNode(license.tier);
                tierCell.appendChild(textNode);
                row.appendChild(tierCell);

                const expiresCell = document.createElement('td');
                expiresCell.textContent = license.expires;
                row.appendChild(expiresCell);

                const tokensCell = document.createElement('td');
                const tokens = `${license.available_tokens} of ${license.n_tokens} keys available`;
                tokensCell.textContent = tokens;
                row.appendChild(tokensCell);

                tableBody.appendChild(row);
            });
        }
        
       

        // Make the available licenses clickable
        $('.license_options tr').click(function() {
            $(this).children('td').children('input').prop('checked', true);
            
            $('.license_options tr').removeClass('selected');
            $(this).toggleClass('selected');

        });

        function requestErrorHandler(jqXHR, textStatus, errorThrown) {
            $("#hang-on-message").hide();
            console.log("Error: " + errorThrown);
            console.log("Status: " + textStatus);
            console.log("Response: " + jqXHR.responseText);
            showError("Error: " + errorThrown + " Status: " + textStatus + " Response: " + jqXHR.responseText);
        }

        function showError(message) {


            // Show an error message to the user
            var errorBox = document.createElement('div');
            errorBox.classList.add('error-box');
            // Width 80% of the screen
            errorBox.style.width = '80%';
            // Center horizontally
            errorBox.style.margin = '0 auto';

            errorBox.textContent = message;
            // Append to end of 'end-of-page' div
            // document.getElementById('end-of-page').appendChild(errorBox);
            document.body.appendChild(errorBox);

            // Show the "try again" button (try-again-button) (just make it not hidden)
            // $('#try-again-button').css('display', 'block');

            // Scroll to the bottom of the page
            window.scrollTo(0, document.body.scrollHeight);
        }

        function validateCheckboxes() {
            // List of all checkbox IDs
            var checkboxIds = [
                "understand_prototype",
                "evaluation_purposes",
                "assistant_not_replacement",
                "software_distribution"
            ];

            // Check if all checkboxes are checked
            for (var i = 0; i < checkboxIds.length; i++) {
                if (!document.getElementById(checkboxIds[i]).checked) {
                    alert("Please check all the boxes before submitting.");
                    return false; // Prevent form submission
                }
            }

            return true; // All checkboxes are checked, allow form submission
        }


        function getDownloadLink() {

            // filePath = "gs://eagleeyessearch.appspot.com/scan_releases/EagleEyesScan_0.4.3_MacOS_arm64.zip"
            // filePath = "scan_releases/EagleEyesScan_0.4.3_MacOS_arm64.zip"


            var hostUrl = getHostUrl();
            var selectElement = document.getElementById('software_version');
            var filePath = "scan_releases/" + selectElement.value;
            var fetch_url = hostURL + '/generate_download_link?filePath=' + filePath;


            // Pack the form data into an object
            
            hasFormBeenShown = $("#form").is(":visible");
            console.log("Form has been shown?: " + hasFormBeenShown);
            var formData = null;
            if (hasFormBeenShown) {
                if (!validateCheckboxes()) {
                    return; // Stop the function if validation fails
                }
                var formInputs = document.querySelectorAll('input[type=text], input[type=password], input[type=checkbox], input[type=radio], select, textarea');
                formData = {};
                for (var i = 0; i < formInputs.length; i++) {
                    var input = formInputs[i];
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        formData[input.name] = input.checked;
                    } else {
                        formData[input.name] = input.value;
                    }
                }
            } 

            downloadStatusSpan=$("#downloadStatus");
            statusText = "Hang on a moment, download should start automatically...";
            console.log("Back up link: " + backUpLinkOrNull);
            if (backUpLinkOrNull !== null) {
                statusText += "If it doesn't, you can click <a href='" + backUpLinkOrNull + "'>here</a> to download it manually.";
            }
            downloadStatusSpan.html(statusText);

            console.log("Checking URL: " + fetch_url);
            console.log("Fetch URL: " + fetch_url);
            globalUser.getIdToken(true).then(function (idToken) {

                $.ajax({
                    url: fetch_url,
                    data: JSON.stringify(formData),
                    type: 'POST', // Changed from 'method' to 'type' for clarity, though both are acceptable. Use 'POST' since you're sending a body.
                    contentType: 'application/json', // This sets the Content-Type header to application/json
                    headers: {
                        'Authorization': 'Bearer ' + idToken
                    },
                    success: function (data) {
                        data = JSON.parse(data);
                        console.log("Success: " + data);
                        var downloadLink = data.url;
                        console.log("Download link: " + downloadLink);

                        // Show user message with link and ask them if they want to download
                        // If yes, then redirect to the link
                        // If no, then do nothing

                        // Hide the download button/div after submitting form
                        $("#download-button-div").hide();


                        window.location.href = downloadLink;
                        $("#signin").hide();
                        $("#form").hide();
                        $("#post-download").show();
                        $("#download-link").attr("href", downloadLink);


                    },
                    error: requestErrorHandler,
                });
            });

        }

    </script>
    <script>
         // Example data - to be replaced with the actual data fetching logic
         const licenses = [
            { tier: 'Eagle Eyes Scan SAR - 1 Month', expires: '2024-04-10', available_tokens: 0, n_tokens: 1},
            { tier: 'Eagle Eyes Scan SAR - 1 Year', expires: '2025-04-27', available_tokens: 4, n_tokens: 5},
        ];

        // Populate the table
        populateTable();


    </script>


</body>

