---
layout: ee_page_layout
title: Add Eagle Eyes License (Admin)
permalink: /add_license/
---

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Password Prompt</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- Import JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="/css/form_buttons_and_boxes.css">
    <!-- The moment library is used to handle dates and times -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>

    <!-- shared.js functions -->
    <script src="/shared.js"></script>
</head>

<body>
    <style>
        .container {
            width: 80%; /* Set the width of the form container */
            margin: auto; /* Center the container */
        }
    
        .container label, .container input, .container select, .container textarea {
            display: block; /* Ensures each element appears on its own line */
            margin: 10px 0; /* Adds vertical spacing */
            width: 100%; /* Full width to align correctly */
        }
    
        .container label.title {
            display: inline-block; /* Titles on the same line as fields */
            margin-right: 10px; /* Space between title and field */
            font-size: 0.9em; /* Smaller font size for titles */
        }
    
        .radio-container {
            display: block; /* Ensures each radio option container is on a new line */
            margin-top: 5px;
        }
    
        .radio-container input[type="radio"] {
            display: inline-block; /* Radio buttons are inline */
            width: auto; /* Override width to fit content */
            margin-right: 5px; /* Space between radio button and label */
        }
    
        .radio-container label {
            display: inline; /* Labels inline with radio buttons */
            font-size: 0.9em; /* Smaller font size for radio labels */
        }
    
        input[type="text"], input[type="password"], select, textarea {
            padding: 8px 16px; /* Adjust padding */
            border: 1px solid #ccc; /* Standard border */
            box-sizing: border-box; /* Border box model */
        }
    
        br {
            display: block; /* Ensures breaks are effective */
            margin: 5px 0; /* Adds margin around breaks */
        }
    </style>
    
    


    <section id="signin">
        <div class="info-box" id="using-emulator-info" style="display: none;">Using local Firebase emulator</div>
        <h1>Add a License</h1>
        Eagle Eyes Scan is a desktop app, available for MacOS and Windows.
        <h3> Step 1: Sign in </h3>
        {% include signinWidget.html %}
    </section>

    <section id="form" hidden>
        <h3> Welcome admin. Enter Licensing details below</h3>
        <span id="place_to_view"></span>
        <form onsubmit="event.preventDefault(); handleForm();">
            <div class="container">
                <label for="extra_security_password"><b>Admin Password: </b></label>
                Input the admin password for extra security
                <br />
                <input type="password" placeholder="Enter Admin Password" id="extra_security_password" name="extra_security_password" required>
                <br />
                <label for="license_name"><b>License Name: (optional)</b></label>
                What to call this license
                <br />
                <input type="text" placeholder="Enter License Name" id="license_name" name="license_name">
                <br /><br />
                <label for="emails"><b>Emails: (required)</b></label>
                Comma-separated list of emails to add to this license
                <br />
                <input type="text" placeholder="joe@example.com,bob@example.com" id="emails" name="emails" required>
                <br /><br />
                <label for="domains"><b>Domains: (optional)</b></label>
                Comma-separated list of domains to add to this license
                <br />
                <input type="text" placeholder="examplecountysar.org,someotherdomain.com" id="domains" name="domains">
                <br /><br />
                <fieldset>
                    <legend><b>User Type:</b></legend>
                    <div class="radio-container">
                        <input type="radio" id="volunteer" name="userType" value="volunteer" required>
                        <label for="volunteer">Volunteer</label>
                    </div>
                    <div class="radio-container">
                        <input type="radio" id="general" name="userType" value="general" required>
                        <label for="general">General</label>
                    </div>
                    <div class="radio-container">
                        <input type="radio" id="special" name="userType" value="special" required>
                        <label for="special">Special</label>
                    </div>
                </fieldset>
                <br />
                <fieldset>
                    <legend><b>License Duration:</b></legend>
                    <select id="licenseDurationSelect" name="license_duration" required>
                        <!-- Options will be dynamically populated here -->
                    </select>
                    <br />
                </fieldset>
                <br />
                <button type="submit" class="createLicenseButton">Create license</button>
                <br />
            </div>
        </form>
        <br />
    </section>
    <div id="creationStatus"></div>

    <script>

        console.log('About to define handleForm');

        hostURL = getHostURL();

        $(document).ready(function() {
            // Populate license duration select
            const licenseOptions = [
                { value: 'no_license', text: 'No License' },
                { value: 'two_weeks', text: 'Intro License: Pro - 2 Weeks' },
                { value: 'one_month', text: 'Pro - 1 Month' },
                { value: 'three_months', text: 'Pro - 3 Months' },
                { value: 'one_year', text: 'Pro - 1 Year' },
                { value: 'live', text: 'Live' }
            ];

            const $licenseDurationSelect = $('#licenseDurationSelect');
            $.each(licenseOptions, function(index, option) {
                $licenseDurationSelect.append($('<option>', {
                    value: option.value,
                    text: option.text
                }));
            });

        });

        console.log('About to register sign-in listener');
        // Listener for sign-in completion
        document.addEventListener('signInComplete', function (e) {
            var globalUser = e.detail.user;
            console.log('User signed in: ' + globalUser.email);
            globalUser.getIdToken(true).then(function (idToken) {
                var requestURL = hostURL + '/is_logged_in_user_admin';
                console.log('Request URL: ' + requestURL);
                $.ajax({
                    url: requestURL,
                    type: 'POST',
                    contentType: 'application/json',
                    headers: {
                        'Authorization': 'Bearer ' + idToken
                    },
                    success: function (data) {
                        var isAdmin = JSON.parse(data).is_admin;
                        console.log('isAdmin: ' + isAdmin);
                        if (isAdmin) {
                            $('#form').show();
                        } else {
                            $('#creationStatus').text('Access denied. You are not authorized to add licenses.');
                            $('#form').hide();
                        }
                    },
                    error: function () {
                        alert('Failed to verify admin status.');
                    }
                });
            });
        });
    </script>
</body>
