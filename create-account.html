---
layout: main
title: Create an Account - Eagle Eyes
---

<div class="section-block bkg-grey-ultralight" style="padding: 120px 0 30px 0;">
    <div class="row">
        <div class="column width-12">
            <div class="centered">
                <h2 class="mb-10">Create an Account</h2>
                <div style="display: flex; justify-content: center; align-items: center; gap: 20px;">
                    <div id="userEmailDisplay" style="color: #666; font-size: 16px;"></div>
                    <div id="signOutContainer" style="display: none;">
                        <a href="#" id="signOutButton" class="button small rounded" style="padding: 8px 15px; font-size: 14px;">Sign Out</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="section-block" style="padding-top: 20px;">
    <div class="row">
        <div class="column width-8 offset-2">
            <!-- Include form styling -->
            {% include form_styling.html %}
            
            <!-- Sign in button (will trigger overlay) -->
            <div id="signinButtonSection" style="display: none; text-align: center; margin-bottom: 40px;">
                <p style="margin-bottom: 20px;">Sign in to create your account and start your free trial.</p>
                <button id="accountSignInButton" class="button" onclick="toggleSignIn()">Sign In or Create Account</button>
            </div>

            <!-- Sign in overlay -->
            <div id="signin-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000;">
                <div style="position: relative; width: 100%; height: 100%;">
                    {% include signinwidget-main.html %}
                    <button onclick="toggleSignIn()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; color: white; font-size: 24px; cursor: pointer;">&times;</button>
                </div>
            </div>

            <!-- Trial form content section -->
            <div id="form-container" class="box rounded xlarge bkg-white shadow" style="display: none;">
                <div class="box-content">
                    <div class="row">
                        <div class="column width-12">
                            <h3 class="mb-30"></h3>
                            <p style="text-align: center;">Please take a minute to share a few details and create your account.</p>
                            
                            {% include account-questions.html %}
                            
                            <div id="submit-container" style="margin-top: 30px; text-align: center;">
                                <button id="submitButton" onclick="submitTrialForm()" type="submit" class="button">Submit</button>
        <div style="display: flex; justify-content: center; align-items: center;">
                                    <div id="status" style="max-width: 550px; text-align: center; font-size: 70%; font-style: italic; color: red; display: none;">Please complete all required fields</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages -->
            <div id="hang-on-message" class="info-box" style="display: none; margin-top: 20px; text-align: center; padding: 20px;">
                Hang on a moment while we get everything ready for you...
            </div>
            
            <div id="post-form" class="info-box" style="display: none; margin-top: 20px; text-align: center; padding: 20px;">
                <div id="checking-licenses-box">Your 30-day trial request was submitted successfully. We will contact you soon. Please reach out to info@eagleeyessearch.com if you have any questions.</div>
            </div>
        </div>
    </div>
</div>

<style>
    /* Radio button styles */
    .radio-group {
        margin-bottom: 20px;
    }
    
    .radio-container {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .radio-container input[type="radio"] {
        margin-right: 10px;
        /* Ensure visibility */
        opacity: 1;
        visibility: visible;
        position: static;
        width: auto;
        height: auto;
    }
    
    /* Fix for labels */
    .radio-container label {
        display: inline-block;
        cursor: pointer;
    }
    
    /* Fix for checkbox containers too */
    .checkbox-container {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .checkbox-container input[type="checkbox"] {
        margin-right: 10px;
        /* Ensure visibility */
        opacity: 1;
        visibility: visible;
        position: static;
        width: auto;
        height: auto;
    }
</style>

<script>
    // Flag to track if we've completed our initial auth check
    let authCheckComplete = false;
    
    // Function to ensure UI is in a consistent state
    function ensureUIState() {
        const user = firebase.auth().currentUser;
        
        if (!authCheckComplete) {
            // We're still checking auth, show loading state
            $("#page-loading").show();
            $("#signin").hide();
            $("#form-container").hide();
        } else if (!user) {
            // User is definitely not signed in
            $("#page-loading").hide();
            $("#signin").show();
            $("#form-container").hide();
        }
        // If user is signed in, the checkUserFormAndRedirect function will handle UI state
    }
    
    // Check user form status and redirect if needed
    function checkUserFormAndRedirect() {
        if (!firebase.auth().currentUser) {
            $("#page-loading").hide();
            $("#form-container").hide();
            $("#signin").show();
            authCheckComplete = true;
            return;
        }
        
        // Check if we just came from account.html to avoid redirect loop
        const cameFromAccount = sessionStorage.getItem('redirecting_from_account') === 'true';
        if (cameFromAccount) {
            // Clear the flag
            sessionStorage.removeItem('redirecting_from_account');
            console.log("Coming from account.html, showing form without checking");
            $("#page-loading").hide();
            $("#form-container").show();
            $("#signin").hide();
            authCheckComplete = true;
            return;
        }
        
        // Still checking
        $("#page-loading").show();
        $("#form-container").hide();
        $("#signin").hide();
        
        firebase.auth().currentUser.getIdToken(true).then(function(idToken) {
            $.ajax({
                url: hostURL + '/has_user_already_filled_in_form',
                type: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + idToken
                },
                success: function(data) {
                    console.log("Got reply from has_user_already_filled_in_form:", data);
                    authCheckComplete = true;
                    
                    let response;
                    try {
                        response = typeof data === 'string' ? JSON.parse(data) : data;
                    } catch (e) {
                        console.error("Error parsing response:", e);
                        response = { form: null };
                    }
                    
                    // Check if form exists
                    const hasFilledForm = response.form && Object.keys(response.form).length > 0;
                    const basePath = getBasePath();
                    
                    if (hasFilledForm) {
                        console.log("User already filled in form, redirecting to account.html");
                        // Set a session flag before redirecting
                        sessionStorage.setItem('redirecting_from_create_account', 'true');
                        window.location.href = basePath + 'account.html';
                    } else {
                        console.log("User has not filled out a form, showing form");
                        $("#page-loading").hide();
                        $("#form-container").show();
                        $("#signin").hide();
                    }
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    console.error("Error checking form status:", textStatus, errorThrown);
                    authCheckComplete = true;
                    $("#page-loading").hide();
                    $("#form-container").show();
                    $("#signin").hide();
                }
            });
        }).catch(function(error) {
            console.error("Error getting ID token:", error);
            authCheckComplete = true;
            $("#page-loading").hide();
            $("#form-container").hide();
            $("#signin").show();
        });
    }

    // Initialize page
    $(document).ready(function() {
        // Add a loading state to the HTML
        if ($("#page-loading").length === 0) {
            $(".column.width-8.offset-2").prepend('<div id="page-loading" style="text-align: center; padding: 40px;"><p>Loading...</p></div>');
        }
        
        // Start with the loading state
        $("#page-loading").show();
        $("#signin").hide();
        $("#form-container").hide();
        
        // Add a safety timeout to ensure something is shown
        setTimeout(function() {
            if (!authCheckComplete) {
                console.log("Auth check taking too long, showing sign-in form");
                $("#page-loading").hide();
                $("#signin").show();
            }
        }, 5000); // 5 second timeout as a fallback
        
        // Listen for auth state
        firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                console.log("User is signed in");
                globalUser = user;
                checkUserFormAndRedirect();
            } else {
                console.log("User is signed out");
                globalUser = null;
                authCheckComplete = true;
                $("#page-loading").hide();
                $("#form-container").hide();
                $("#signin").show();
            }
        });
        
        // Ensure UI is in a consistent state if we navigate back to this page
        window.addEventListener('pageshow', function(event) {
            if (event.persisted) {
                console.log("Page loaded from cache (back/forward navigation)");
                ensureUIState();
            }
        });
    });
</script>